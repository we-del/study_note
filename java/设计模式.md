# 设计模式

## 技巧

```java
/*
 1.多个类存在多个相同方法体的方法仅有个别不同的方法时，此时就可以把这些方法抽象到父类中，不同的方法做成抽象方法让子类实现，相同的方法原样写入(减少文件体积)，然后子类实现这些抽象类即可
 
 2.多个类有需要相同的方法但方法体不同时，就可以把这些类封装到一个接口中，然后这些类实现该接口即可
*/
```



 设计模式在程序中的应用，提高了代码维护性和可扩展性

程序员沟通的工具之一，UML类图

+ 设计模式的重要性

  ```java
  /*
   设计模式是对软件设计中普遍存在的各种问题，所提出的解决方案
  */
  ```

  ![image-20220220193709867](D:\typora_import_images\typora-user-images\image-20220220193709867.png)

  ![image-20220220194117134](D:\typora_import_images\typora-user-images\image-20220220194117134.png)

  

## 前言

**设计模式包含了面向对象的精髓,懂了设计模式，就懂了面向对象分析和(OOA/D)的精要**

![image-20220315103234604](D:\typora_import_images\typora-user-images\image-20220315103234604.png)

![image-20220315103421227](D:\typora_import_images\typora-user-images\image-20220315103421227.png)

+ 设计模式的目的

  ```java
  /*
   为了提高代码的 复用性，可读性，可扩展性，可靠性，高内聚低耦合特性，我们需要遵守七大原则(程序设计原则分为 **单一职责原则，接口隔离原则，依赖倒转原则，里氏替换原则，开闭原则，迪米特法则和合成复用原则**)
   	复用性
   		相同功能代码，不用重复编写
   	可读性
   		编码规范，便于程序阅读
   	可扩展(维护)性
   		当需要增加新的功能时，非常的方便
   	可靠性
   		当添加新的功能后，对原来的功能没有影响
   	高内聚低耦合
   		模块内部联系紧密，模块与模块间耦合性低
   		
  注意
  	不要使用多层 if-else if-else if ... 多层嵌套，这样才能降低程序耦合度
  */
  ```
  
  

![image-20220301151222923](D:\typora_import_images\typora-user-images\image-20220301151222923.png)

![image-20220301151524763](D:\typora_import_images\typora-user-images\image-20220301151524763.png)













## 1.0 程序设计原则

+ 程序设计原则分为 **单一职责原则，接口隔离原则，依赖倒转原则，里氏替换原则，开闭原则，迪米特法则和合成复用原则**

+ 单一职责原则

  ```java
  /*
  介绍
      对类来说,一个类应该只负责一项职责。如类A负责两个不同职责:职责1,职责2.当职责1需求变更而改变A		     时，可能造成职责2执行错误，所以需要将类A的粒度分解为 A1,A2
  优点
      降低类的复杂度，一个类只负责一项职责
      提高类的可读性，可维护性
  使用实例
  ==================================================
  // 错误实例
  public class SingleResponsibility1 {
  
  	public static void main(String[] args) {
  		// TODO Auto-generated method stub
  		Vehicle vehicle = new Vehicle();
  		vehicle.run("摩托车");
  		vehicle.run("汽车");
  		vehicle.run("飞机");
  	}
  
  }
  
  // 交通工具类
  // 方式1
  // 1. 在方式1 的run方法中，违反了单一职责原则
  // 2. 解决的方案非常的简单，根据交通工具运行方法不同，分解成不同类即可
  class Vehicle {
  	public void run(String vehicle) {
  		System.out.println(vehicle + " 在公路上运行....");
  	}
  }
  
  ==================================================
  // 正确实例
  public class SingleResponsibility3 {
  
      public static void main(String[] args) {
  // TODO Auto-generated method stub
          Vehicle2 vehicle2 = new Vehicle2();
          vehicle2.run("汽车");
          vehicle2.runWater("轮船");
          vehicle2.runAir("飞机");
      }
  
  }
  
  class Vehicle2 {
      public void run(String vehicle) {
  //处理
  
          System.out.println(vehicle + " 在公路上运行....");
  
      }
  
      public void runAir(String vehicle) {
          System.out.println(vehicle + " 在天空上运行....");
      }
  
      public void runWater(String vehicle) {
          System.out.println(vehicle + " 在水中行....");
      }
  }
  
  注意
      通常情况下，我们应当遵守单一职责原则，只有逻辑足够简单，才可以在代码级违反单一职责原则的；只有类中方法数量足够少，可在方法级别保持单一职责原则
  */
  ```

  

+ 接口隔离原则(interface segregation principle)

  ```java
  /*
   介绍
   	客户端不应该依赖它不需要的接口，即一个类对另一个类的依赖应该建立在最小的接口个数上(即把一个大接口拆成若干小接口，然后实现需要用到的接口(方法) )
   	如 类A 实现了接口的方法(5个)，但其实际用到的方法就三个，此时就应该将那3个方法专门开一个接		   口，在让类A实现，减少无用方法实现，此时才满足了接口隔离原则
   	
   使用实例
   =====================================================
   // 错误实例
   public class Segregation1 {
  
  	public static void main(String[] args) {
  		// TODO Auto-generated method stub
  
  	}
  
  }
  
  //接口
  interface Interface1 {
  	void operation1();
  	void operation2();
  	void operation3();
  	void operation4();
  	void operation5();
  }
  
  class B implements Interface1 {
  	public void operation1() {
  		System.out.println("B 实现了 operation1");
  	}
  	
  	public void operation2() {
  		System.out.println("B 实现了 operation2");
  	}
  	public void operation3() {
  		System.out.println("B 实现了 operation3");
  	}
  	public void operation4() {
  		System.out.println("B 实现了 operation4");
  	}
  	public void operation5() {
  		System.out.println("B 实现了 operation5");
  	}
  }
  
  class D implements Interface1 {
  	public void operation1() {
  		System.out.println("D 实现了 operation1");
  	}
  	
  	public void operation2() {
  		System.out.println("D 实现了 operation2");
  	}
  	public void operation3() {
  		System.out.println("D 实现了 operation3");
  	}
  	public void operation4() {
  		System.out.println("D 实现了 operation4");
  	}
  	public void operation5() {
  		System.out.println("D 实现了 operation5");
  	}
  }
  
  class A { //A 类通过接口Interface1 依赖(使用) B类，但是只会用到1,2,3方法
  	public void depend1(Interface1 i) {
  		i.operation1();
  	}
  	public void depend2(Interface1 i) {
  		i.operation2();
  	}
  	public void depend3(Interface1 i) {
  		i.operation3();
  	}
  }
    
  class C { //C 类通过接口Interface1 依赖(使用) D类，但是只会用到1,4,5方法
  	public void depend1(Interface1 i) {
  		i.operation1();
  	}
  	public void depend4(Interface1 i) {
  		i.operation4();
  	}
  	public void depend5(Interface1 i) {
  		i.operation5();
  	}
  }
   =====================================================
    // 正确实例
   	public class Segregation1 {
  
  	public static void main(String[] args) {
  		// TODO Auto-generated method stub
  		// 使用一把
  		A a = new A();
  		a.depend1(new B()); // A类通过接口去依赖B类
  		a.depend2(new B());
  		a.depend3(new B());
  
  		C c = new C();
  
  		c.depend1(new D()); // C类通过接口去依赖(使用)D类
  		c.depend4(new D());
  		c.depend5(new D());
  
  	}
  
  }
  
      // 接口1
      interface Interface1 {
          void operation1();
  
      }
  
      // 接口2
      interface Interface2 {
          void operation2();
  
          void operation3();
      }
  
      // 接口3
      interface Interface3 {
          void operation4();
  
          void operation5();
      }
  
      class B implements Interface1, Interface2 {
          public void operation1() {
              System.out.println("B 实现了 operation1");
          }
  
          public void operation2() {
              System.out.println("B 实现了 operation2");
          }
  
          public void operation3() {
              System.out.println("B 实现了 operation3");
          }
  
      }
  
      class D implements Interface1, Interface3 {
          public void operation1() {
              System.out.println("D 实现了 operation1");
          }
  
          public void operation4() {
              System.out.println("D 实现了 operation4");
          }
  
          public void operation5() {
              System.out.println("D 实现了 operation5");
          }
      }
  
      class A { // A 类通过接口Interface1,Interface2 依赖(使用) B类，但是只会用到1,2,3方法
          public void depend1(Interface1 i) {
              i.operation1();
          }
  
          public void depend2(Interface2 i) {
              i.operation2();
          }
  
          public void depend3(Interface2 i) {
              i.operation3();
          }
      }
  
      class C { // C 类通过接口Interface1,Interface3 依赖(使用) D类，但是只会用到1,4,5方法
          public void depend1(Interface1 i) {
              i.operation1();
          }
  
          public void depend4(Interface3 i) {
              i.operation4();
          }
  
          public void depend5(Interface3 i) {
              i.operation5();
          }
      }
  
  
  */
  ```
  
  ![image-20220223211837241](D:\typora_import_images\typora-user-images\image-20220223211837241.png)



+ 依赖倒转原则(Dependence Inversion Principle)

  ```java
  /*
   概念词解释
   	抽象，指 接口或抽象类
   	细节，指 具体的实现类
   介绍
   	高层模块不应该依赖低层模块，二者都应该依赖其抽象
   	抽象不应该依赖细节，细节应该以来抽象
   	依赖倒转(倒置)的中心思想是面向接口编程
   
   设计理念
   	相对于细节的多变性，抽象的东西要稳定的多，以抽象为基础搭建的架构比以细节为基础的架构要稳定的多(因为细节容易产生更改，但抽象相对稳定)
   
   依赖关系传递方式
   	方式1：接口传递
      // 开关的接口
       interface IOpenAndClose {
       	public void open(ITV tv); //抽象方法,接收接口
       }
  
       interface ITV { //ITV接口
       	public void play();
       }
  
       class ChangHong implements ITV {
  
          @Override
          public void play() {
              // TODO Auto-generated method stub
              System.out.println("长虹电视机，打开");
          }
  
       }
       // 实现接口
       class OpenAndClose implements IOpenAndClose{
       	public void open(ITV tv){
       		tv.play();
       	}
       }
       
   	方式2：构造方法传递
   	 interface IOpenAndClose {
       	public void open(); //抽象方法
       }
       interface ITV { //ITV接口
       	public void play();
       }
       class OpenAndClose implements IOpenAndClose{
       	public ITV tv; //成员
       	public OpenAndClose(ITV tv){ //构造器
       		this.tv = tv;
       	}
       	public void open(){
       		this.tv.play();
       	}
       }
       
   	方式3：setter方式传递
   	interface IOpenAndClose {
          public void open(); // 抽象方法
  
          public void setTv(ITV tv);
      }
  
      interface ITV { // ITV接口
          public void play();
      }
  
      class OpenAndClose implements IOpenAndClose {
          private ITV tv;
  
          public void setTv(ITV tv) {
              this.tv = tv;
          }
  
          public void open() {
              this.tv.play();
          }
      }
  
      class ChangHong implements ITV {
  
          @Override
          public void play() {
              // TODO Auto-generated method stub
              System.out.println("长虹电视机，打开");
          }
  
      }
   使用实例
   =====================================================
   // 错误实例
   public class DependecyInversion {
  
  	public static void main(String[] args) {
  		Person person = new Person();
  		person.receive(new Email());
  	}
  
  }
  
  
  class Email {
  	public String getInfo() {
  		return "电子邮件信息: hello,world";
  	}
  }
  
  //完成Person接收消息的功能
  public class DependecyInversion {
  
  	public static void main(String[] args) {
  		Person person = new Person();
  		person.receive(new Email());
  	}
  
  }
  
  
  class Email {
  	public String getInfo() {
  		return "电子邮件信息: hello,world";
  	}
  }
  
  //完成Person接收消息的功能
  //方式1分析
  //1. 简单，比较容易想到
  //2. 如果我们获取的对象是 微信，短信等等，则新增类，同时Perons也要增加相应的接收方法
  //3. 解决思路：引入一个抽象的接口IReceiver, 表示接收者, 这样Person类与接口IReceiver发生依赖
  //   因为Email, WeiXin 等等属于接收的范围，他们各自实现IReceiver 接口就ok, 这样我们就符号依赖倒转原则
  class Person {
  	public void receive(Email email ) {
  		System.out.println(email.getInfo());
  	}
  }
   =====================================================
   // 正确实例
   public class DependecyInversion {
  
  	public static void main(String[] args) {
  		//客户端无需改变
  		Person person = new Person();
  		person.receive(new Email());
  		
  		person.receive(new WeiXin());
  	}
  
  }
  
  //定义接口
  interface IReceiver {
  	public String getInfo();
  }
  
  class Email implements IReceiver {
  	public String getInfo() {
  		return "电子邮件信息: hello,world";
  	}
  }
  
  //增加微信
  class WeiXin implements IReceiver {
  	public String getInfo() {
  		return "微信信息: hello,ok";
  	}
  }
  
  //方式2
  class Person {
  	//这里我们是对接口的依赖
  	public void receive(IReceiver receiver ) {
  		System.out.println(receiver.getInfo());
  	}
  }
  
  注意
  	底层模块精良都要有抽象类或接口，或者两者都有，程序稳定性更好
  	变量的声明类型尽量是抽象类或接口,这样我们的变量引用和实例对象间,就存在一个缓冲层，利于程序扩展和优化
  	j
  */
  ```

  

+ 里氏替换原则

  ![image-20220228205828985](D:\typora_import_images\typora-user-images\image-20220228205828985.png)

  ![image-20220228210212361](D:\typora_import_images\typora-user-images\image-20220228210212361.png)

  ![image-20220228211518855](D:\typora_import_images\typora-user-images\image-20220228211518855.png)

  ```java
  /*
   使用实例
   =====================================================
   // 错误实例
   public class Liskov {
  
  	public static void main(String[] args) {
  		// TODO Auto-generated method stub
  		A a = new A();
  		System.out.println("11-3=" + a.func1(11, 3));
  		System.out.println("1-8=" + a.func1(1, 8));
  
  		System.out.println("-----------------------");
  		B b = new B();
  		System.out.println("11-3=" + b.func1(11, 3));//这里本意是求出11-3
  		System.out.println("1-8=" + b.func1(1, 8));// 1-8
  		System.out.println("11+3+9=" + b.func2(11, 3));
  		
  		
  
  	}
  
  }
  
  // A类
  class A {
  	// 返回两个数的差
  	public int func1(int num1, int num2) {
  		return num1 - num2;
  	}
  }
  
  // B类继承了A
  // 增加了一个新功能：完成两个数相加,然后和9求和
  class B extends A {
  	//这里，重写了A类的方法, 可能是无意识
  	public int func1(int a, int b) {
  		return a + b;
  	}
  
  	public int func2(int a, int b) {
  		return func1(a, b) + 9;
  	}
  }
   =====================================================
   // 正确实例
   public class Liskov {
  
  	public static void main(String[] args) {
  		// TODO Auto-generated method stub
  		A a = new A();
  		System.out.println("11-3=" + a.func1(11, 3));
  		System.out.println("1-8=" + a.func1(1, 8));
  
  		System.out.println("-----------------------");
  		B b = new B();
  		//因为B类不再继承A类，因此调用者，不会再func1是求减法
  		//调用完成的功能就会很明确
  		System.out.println("11+3=" + b.func1(11, 3));//这里本意是求出11+3
  		System.out.println("1+8=" + b.func1(1, 8));// 1+8
  		System.out.println("11+3+9=" + b.func2(11, 3));
  		
  		
  		//使用组合仍然可以使用到A类相关方法
  		System.out.println("11-3=" + b.func3(11, 3));// 这里本意是求出11-3
  		
  
  	}
  
  }
  
  //创建一个更加基础的基类
  class Base {
  	//把更加基础的方法和成员写到Base类
  }
  
  // A类
  class A extends Base {
  	// 返回两个数的差
  	public int func1(int num1, int num2) {
  		return num1 - num2;
  	}
  }
  
  // B类继承了A
  // 增加了一个新功能：完成两个数相加,然后和9求和
  class B extends Base {
  	//如果B需要使用A类的方法,使用组合关系
  	private A a = new A();
  	
  	//这里，重写了A类的方法, 可能是无意识
  	public int func1(int a, int b) {
  		return a + b;
  	}
  
  	public int func2(int a, int b) {
  		return func1(a, b) + 9;
  	}
  	
  	//我们仍然想使用A的方法
  	public int func3(int a, int b) {
  		return this.a.func1(a, b);
  	}
  }
  */
  ```

  

+ 开闭原则

  ![image-20220228213857745](D:\typora_import_images\typora-user-images\image-20220228213857745.png)

  ![image-20220228213050251](D:\typora_import_images\typora-user-images\image-20220228213050251.png)

  ```java
  /*
   使用实例
   ===================================
   // 错误实例
   public class Ocp {
  
  	public static void main(String[] args) {
  		//使用看看存在的问题
  		GraphicEditor graphicEditor = new GraphicEditor();
  		graphicEditor.drawShape(new Rectangle());
  		graphicEditor.drawShape(new Circle());
  		graphicEditor.drawShape(new Triangle());
  	}
  
  }
  
  //这是一个用于绘图的类 [使用方]
  class GraphicEditor {
  	//接收Shape对象，然后根据type，来绘制不同的图形
  	public void drawShape(Shape s) {
  		if (s.m_type == 1)
  			drawRectangle(s);
  		else if (s.m_type == 2)
  			drawCircle(s);
  		else if (s.m_type == 3)
  			drawTriangle(s);
  	}
  
  	//绘制矩形
  	public void drawRectangle(Shape r) {
  		System.out.println(" 绘制矩形 ");
  	}
  
  	//绘制圆形
  	public void drawCircle(Shape r) {
  		System.out.println(" 绘制圆形 ");
  	}
  	
  	//绘制三角形
  	public void drawTriangle(Shape r) {
  		System.out.println(" 绘制三角形 ");
  	}
  }
  
  //Shape类，基类
  class Shape {
  	int m_type;
  }
  
  class Rectangle extends Shape {
  	Rectangle() {
  		super.m_type = 1;
  	}
  }
  
  class Circle extends Shape {
  	Circle() {
  		super.m_type = 2;
  	}
  }
  
  //新增画三角形
  class Triangle extends Shape {
  	Triangle() {
  		super.m_type = 3;
  	}
  }
  
  //=======================================
  
  // 正确实例
  	public class Ocp {
  
  	public static void main(String[] args) {
  		//使用看看存在的问题
  		GraphicEditor graphicEditor = new GraphicEditor();
  		graphicEditor.drawShape(new Rectangle());
  		graphicEditor.drawShape(new Circle());
  		graphicEditor.drawShape(new Triangle());
  		graphicEditor.drawShape(new OtherGraphic());
  	}
  
  }
  
  //这是一个用于绘图的类 [使用方]
  class GraphicEditor {
  	//接收Shape对象，调用draw方法
  	public void drawShape(Shape s) {
  		s.draw();
  	}
  
  	
  }
  
  //Shape类，基类
  abstract class Shape {
  	int m_type;
  	
  	public abstract void draw();//抽象方法
  }
  
  class Rectangle extends Shape {
  	Rectangle() {
  		super.m_type = 1;
  	}
  
  	@Override
  	public void draw() {
  		// TODO Auto-generated method stub
  		System.out.println(" 绘制矩形 ");
  	}
  }
  
  class Circle extends Shape {
  	Circle() {
  		super.m_type = 2;
  	}
  	@Override
  	public void draw() {
  		// TODO Auto-generated method stub
  		System.out.println(" 绘制圆形 ");
  	}
  }
  
  //新增画三角形
  class Triangle extends Shape {
  	Triangle() {
  		super.m_type = 3;
  	}
  	@Override
  	public void draw() {
  		// TODO Auto-generated method stub
  		System.out.println(" 绘制三角形 ");
  	}
  }
  
  //新增一个图形
  class OtherGraphic extends Shape {
  	OtherGraphic() {
  		super.m_type = 4;
  	}
  
  	@Override
  	public void draw() {
  		// TODO Auto-generated method stub
  		System.out.println(" 绘制其它图形 ");
  	}
  }
  */
  ```

  

+ 迪米特法则

  ![image-20220301092422416](D:\typora_import_images\typora-user-images\image-20220301092422416.png)

  ![image-20220301093821418](D:\typora_import_images\typora-user-images\image-20220301093821418.png)
  
  ```java
  /*
  注意
  	当类(实例对象)出现在其他类中的成员变量(属性)，方法形参，方法返回值中的位置时，此时被称为直接朋友；当类(实例对象)出现在方法内部，被当作局部变量时，不称为直接朋友 。 所以为了满足迪米特法则，所有的类(实例对象)在其他类中出现时，要当作员变量(属性)，方法形参或方法返回值 出现
   使用实例
   ==============================================
   // 错误实例
   //客户端
  public class Demeter1 {
  
  	public static void main(String[] args) {
  		//创建了一个 SchoolManager 对象
  		SchoolManager schoolManager = new SchoolManager();
  		//输出学院的员工id 和  学校总部的员工信息
  		schoolManager.printAllEmployee(new CollegeManager());
  
  	}
  
  }
  
  
  //学校总部员工类
  class Employee {
  	private String id;
  
  	public void setId(String id) {
  		this.id = id;
  	}
  
  	public String getId() {
  		return id;
  	}
  }
  
  
  //学院的员工类
  class CollegeEmployee {
  	private String id;
  
  	public void setId(String id) {
  		this.id = id;
  	}
  
  	public String getId() {
  		return id;
  	}
  }
  
  
  //管理学院员工的管理类
  class CollegeManager {
  	//返回学院的所有员工
  	public List<CollegeEmployee> getAllEmployee() {
  		List<CollegeEmployee> list = new ArrayList<CollegeEmployee>();
  		for (int i = 0; i < 10; i++) { //这里我们增加了10个员工到 list
  			CollegeEmployee emp = new CollegeEmployee();
  			emp.setId("学院员工id= " + i);
  			list.add(emp);
  		}
  		return list;
  	}
  }
  
  //学校管理类
  
  //分析 SchoolManager 类的直接朋友类有哪些 Employee、CollegeManager
  //CollegeEmployee 不是 直接朋友 而是一个陌生类，这样违背了 迪米特法则 
  class SchoolManager {
  	//返回学校总部的员工
  	public List<Employee> getAllEmployee() {
  		List<Employee> list = new ArrayList<Employee>();
  		
  		for (int i = 0; i < 5; i++) { //这里我们增加了5个员工到 list
  			Employee emp = new Employee();
  			emp.setId("学校总部员工id= " + i);
  			list.add(emp);
  		}
  		return list;
  	}
  
  	//该方法完成输出学校总部和学院员工信息(id)
  	void printAllEmployee(CollegeManager sub) {
  		
  		//分析问题
  		//1. 这里的 CollegeEmployee 不是  SchoolManager的直接朋友
  		//2. CollegeEmployee 是以局部变量方式出现在 SchoolManager
  		//3. 违反了 迪米特法则 
  		
  		//获取到学院员工
  		List<CollegeEmployee> list1 = sub.getAllEmployee();
  		System.out.println("------------学院员工------------");
  		for (CollegeEmployee e : list1) {
  			System.out.println(e.getId());
  		}
  		//获取到学校总部员工
  		List<Employee> list2 = this.getAllEmployee();
  		System.out.println("------------学校总部员工------------");
  		for (Employee e : list2) {
  			System.out.println(e.getId());
  		}
  	}
  }
  
  // =============================\
  // 正确实例
  //客户端
  public class Demeter1 {
  
  	public static void main(String[] args) {
  		System.out.println("~~~使用迪米特法则的改进~~~");
  		//创建了一个 SchoolManager 对象
  		SchoolManager schoolManager = new SchoolManager();
  		//输出学院的员工id 和  学校总部的员工信息
  		schoolManager.printAllEmployee(new CollegeManager());
  
  	}
  
  }
  
  
  //学校总部员工类
  class Employee {
  	private String id;
  
  	public void setId(String id) {
  		this.id = id;
  	}
  
  	public String getId() {
  		return id;
  	}
  }
  
  
  //学院的员工类
  class CollegeEmployee {
  	private String id;
  
  	public void setId(String id) {
  		this.id = id;
  	}
  
  	public String getId() {
  		return id;
  	}
  }
  
  
  //管理学院员工的管理类
  class CollegeManager {
  	//返回学院的所有员工
  	public List<CollegeEmployee> getAllEmployee() {
  		List<CollegeEmployee> list = new ArrayList<CollegeEmployee>();
  		for (int i = 0; i < 10; i++) { //这里我们增加了10个员工到 list
  			CollegeEmployee emp = new CollegeEmployee();
  			emp.setId("学院员工id= " + i);
  			list.add(emp);
  		}
  		return list;
  	}
  	
  	//输出学院员工的信息
  	public void printEmployee() {
  		//获取到学院员工
  		List<CollegeEmployee> list1 = getAllEmployee();
  		System.out.println("------------学院员工------------");
  		for (CollegeEmployee e : list1) {
  			System.out.println(e.getId());
  		}
  	}
  }
  
  //学校管理类
  
  //分析 SchoolManager 类的直接朋友类有哪些 Employee、CollegeManager
  //CollegeEmployee 不是 直接朋友 而是一个陌生类，这样违背了 迪米特法则 
  class SchoolManager {
  	//返回学校总部的员工
  	public List<Employee> getAllEmployee() {
  		List<Employee> list = new ArrayList<Employee>();
  		
  		for (int i = 0; i < 5; i++) { //这里我们增加了5个员工到 list
  			Employee emp = new Employee();
  			emp.setId("学校总部员工id= " + i);
  			list.add(emp);
  		}
  		return list;
  	}
  
  	//该方法完成输出学校总部和学院员工信息(id)
  	void printAllEmployee(CollegeManager sub) {
  		
  		//分析问题
  		//1. 将输出学院的员工方法，封装到CollegeManager
  		sub.printEmployee();
  	
  		//获取到学校总部员工
  		List<Employee> list2 = this.getAllEmployee();
  		System.out.println("------------学校总部员工------------");
  		for (Employee e : list2) {
  			System.out.println(e.getId());
  		}
  	}
  }
  */
  ```
  
  ![image-20220301094700241](D:\typora_import_images\typora-user-images\image-20220301094700241.png)



+ 合成复用原则

  ![image-20220301103535844](D:\typora_import_images\typora-user-images\image-20220301103535844.png)

  ```java
  /*
   介绍
   	原则是 尽量使用合成/聚合的方式，而不是使用继承
   	
   名词解释
   	依赖
   		指一个类中的一个方法的形参中可接收另一个类的实例对象，此关系被称为依赖
   	聚合
   		指一个类中的属性可接收另一个类的实例对象
   	组合
   		指一个类中的属性为另一个类的实例对象
   
   设计核心思想
   	找出应用中可能需要变化之处，将他们独立出来，不要和那些不需要变化的代码混在一起
   	针对接口变量，而不是针对实现编程
   	为了交互对象之间的松耦合设计而努力
  */
  ```



## 1.1 UML类图

类图用于描述类与类之间的关系，包括**依赖，泛化(继承)，实现，关联，聚合与组合**

+ 名词解释

  ![image-20220301142445980](D:\typora_import_images\typora-user-images\image-20220301142445980.png)

  ![image-20220301142522531](D:\typora_import_images\typora-user-images\image-20220301142522531.png)

  ![image-20220301142544874](D:\typora_import_images\typora-user-images\image-20220301142544874.png)

  ![image-20220301142731891](D:\typora_import_images\typora-user-images\image-20220301142731891.png)

  ![image-20220301143943028](D:\typora_import_images\typora-user-images\image-20220301143943028.png)

  ![image-20220301144306122](D:\typora_import_images\typora-user-images\image-20220301144306122.png)

  

  ```java
  /*
   依赖
   	如果一个类中的 属性，方法形参，方法返回值，或方法局部中 用到了另一个类(或实例对象) ，此关系称为依赖
   泛化
   	泛化关系就是继承关系，但是它是依赖关系的特例(如 A继承了B ,则可以称为 A和B是泛化的关系)
   实现
   	实现关系是依赖关系的特例(如AA实现了C接口)
   关联
   	关联关系实际上就是类与类之间的联系,他是依赖关系的特例(关联关系有导航性(单项关系和双向关系)和多重性)
   聚合
   	聚合关系表示整体和部分的关系，整体与部分可以分开，聚合关系是关联关系的特例。他具有关联的导航性和多重性
   	如 一台健脑有 键盘，显示器，鼠标等组成；组成电脑的各个配件是可以从电脑上分离出来的
   组合
   	整体与局部的关系，但整体与部分不可以分开
   
   注意
   	如果一个类和其他的类的整体联系 可以分开，就是聚合的关系，否则就是组合的关系
   	
  */
  ```

  

+ idea 画uml类图需要的插件

  ```java
  /*
   	在plugin中 下载 PlantUML(画uml类图)，sequence(画时序图)
  */
  ```

  

+ UML介绍

  ![image-20220301104135985](D:\typora_import_images\typora-user-images\image-20220301104135985.png)

  ![image-20220301113031622](D:\typora_import_images\typora-user-images\image-20220301113031622.png)

  ![image-20220301113114160](D:\typora_import_images\typora-user-images\image-20220301113114160.png)

   

  

+ uml类图

  ![image-20220301111607671](D:\typora_import_images\typora-user-images\image-20220301111607671.png)



## 1.2 创建型模式

### 单例模式

饿汉式可以理解为迫不及待的想要创建实例对象(类加载时创建),懒汉式可以理解为只有调用某个行为才会创建一个实例对象(如方法调用时创建实例对象)

+ 单例模式可用创建方法

  ```java
  /*
   饿汉式
   双重检查(推荐) 
   静态内部类(推荐)
   枚举(推荐)
  */
  ```



+ 单例模式总结

  ![image-20220303112521909](D:\typora_import_images\typora-user-images\image-20220303112521909.png)



+ 介绍

  ![image-20220302212154422](D:\typora_import_images\typora-user-images\image-20220302212154422.png)	

  

  

+ 单例模式-饿汉式(静态常量)

  ![image-20220303093618572](D:\typora_import_images\typora-user-images\image-20220303093618572.png)
  
  ```java
  /*
   实现
   	public class SingletonPattern_1 {
      public static void main(String[] args){
          Singleton instance = Singleton.getInstance();
          Singleton instance1 = Singleton.getInstance();
          System.out.println(instance==instance1); // true
      }
  }
  class Singleton {
      private Singleton(){}
      private static Singleton singleton = new Singleton();
      public static Singleton getInstance(){
          return singleton;
      }
  }
  */
  ```
  
  ![image-20220303094440699](D:\typora_import_images\typora-user-images\image-20220303094440699.png)
  
+ 静态代码块写法

  ```java
  /*
   public class SingletonPattern_1 {
      public static void main(String[] args){
          Singleton instance = Singleton.getInstance();
          Singleton instance1 = Singleton.getInstance();
          System.out.println(instance==instance1); // true
      }
  }
  class Singleton {
      private Singleton() {
      }
      private static Singleton singleton ;
      static{
        singleton =   new Singleton();
      }
      public static Singleton getInstance() {
          return singleton;
      }
  }
  */
  ```

  ![image-20220303095138346](D:\typora_import_images\typora-user-images\image-20220303095138346.png)





+ 懒汉式(线程不安全)

  ```java
  /*
   public class SingletonPattern_2 {
      public static void main(String[] args) {
          Singleton instance = Singleton.getInstance();
          Singleton instance1 = Singleton.getInstance();
          System.out.println(instance == instance1); // true
      }
  }
  
  class Singleton {
      // 懒汉式
      private Singleton() {
      }
  
      private static Singleton instance;
  
      public static Singleton getInstance() {
          // 如果为空就创建一个实例对象,否则直接返回已有实例对象(有线程安全问题，可以加互斥锁)
          if (instance == null) {
              instance = new Singleton();
          }
          return instance;
      }
  }
  */
  ```

  ![image-20220303101303374](D:\typora_import_images\typora-user-images\image-20220303101303374.png)

+ 懒汉式(线程安全)

  ```java
  /*
   public class SingletonPattern_4 {
      public static void main(String[] args) {
          Singleton instance = Singleton.getInstance();
          Singleton instance1 = Singleton.getInstance();
          System.out.println(instance == instance1); // true
      }
  }
  
  class Singleton {
      // 懒汉式
      private Singleton() {
      }
  
      private static Singleton instance;
  
      public static synchronized Singleton getInstance() {
          // 如果为空就创建一个实例对象,否则直接返回已有实例对象,使用synchronized关键字限制线程访问
          if (instance == null) {
              instance = new Singleton();
          }
          return instance;
      }
  }
  */
  ```

  ![image-20220303101922492](D:\typora_import_images\typora-user-images\image-20220303101922492.png)

+ 懒汉式-同步代码块(此方法解决不了线程安全问题)

  ![image-20220303102223574](D:\typora_import_images\typora-user-images\image-20220303102223574.png)

  ![image-20220303102403727](D:\typora_import_images\typora-user-images\image-20220303102403727.png)



+ 双重检查(推荐使用)

  ```java
  /*
   public class SingletonPattern_6 {
      public static void main(String[] args) {
          Singleton instance = Singleton.getInstance();
          Singleton instance1 = Singleton.getInstance();
          System.out.println(instance == instance1); // true
      }
  }
  
  class Singleton {
      // 懒汉式
      private Singleton() {
      }
  
      private static volatile Singleton instance;
  
      public static Singleton getInstance() {
          // 使用双重检查判断(推荐使用)
          // 当所有线程第一次进入该方法时，会有多个线程执行到第二个if, synchronized 代码快，进行争抢
          // 当其中的一个线程争抢完毕后，所有线程就返回该实例对象(因为实例对象已经创建成功,if为false)
          // 当所有线程第二次进入该方法时，所有线程会直接返回之间创建的实例对象(因为实例对象已经创建,所有线程在第一个if判断就为false,无法进入第二个有着线程保护的if判断) ，有效提高了效率
          if (instance == null) {
              synchronized (Singleton.class){
                  if(instance == null){
                      instance = new Singleton();
                  }
              }
          }
          return instance;
      }
  }
  */
  ```

  ![image-20220303103419311](D:\typora_import_images\typora-user-images\image-20220303103419311.png)

  



+ 静态内部类（推荐使用）

  ```java
  /*
   特点
   	当外部类被加载后，静态内部类不会被加载
   	在外部类调用静态内部类的方法时，静态内部类才会加载，且加载一次(在装载时，线程安全)
   
   实现
   	public class SingletonPattern_7 {
      public static void main(String[] args) {
      	// 所有线程的hash值一致
          Singleton instance = Singleton.getInstance();
          new TestThread1().start();
          new TestThread2().start();
          Singleton instance1 = Singleton.getInstance();
          System.out.println(instance == instance1); // true
          System.out.println(instance.hashCode());
          System.out.println(instance1.hashCode());
      }
  }
  
  class Singleton {
      // 懒汉式
      private Singleton() {
      }
  
      // 当外部类被加载时，静态内部类不会马上加载，只有其被使用时才会加载
      // 类在加载时，线程安全 (使用final可以提高效率)
      private static final class SingletonInstance{
          private static final Singleton SINGLETON = new Singleton();
      }
      public static Singleton getInstance() {
          // 如果为空就创建一个实例对象,否则直接返回已有实例对象(有线程安全问题，可以加互斥锁)
          return SingletonInstance.SINGLETON;
      }
  }
  
  class TestThread1  extends  Thread{
      @Override
      public void run() {
          Singleton instance = Singleton.getInstance();
          System.out.println(instance.hashCode());
      }
  }
  class TestThread2  extends  Thread{
      @Override
      public void run() {
          Singleton instance = Singleton.getInstance();
          System.out.println(instance.hashCode());
      }
  }
  */
  ```

  ![image-20220303111017261](D:\typora_import_images\typora-user-images\image-20220303111017261.png)



+ 枚举实现

  ```java
  /*
   public class SingletonPattern_8 {
      public static void main(String[] args){
  
          // 枚举对象可以使用枚举内的所有方法
          Singleton instance1 = Singleton.INSTANCE;
          Singleton instance2 = Singleton.INSTANCE;
          instance1.sayOK();
          System.out.println(instance1.hashCode());
          System.out.println(instance2.hashCode());
      }
  }
  // 使用枚举来完成单例模式
  enum Singleton{
      INSTANCE;
      public void sayOK(){
          System.out.println("ok~");
      }
  }
  */
  ```

  ![image-20220303111505681](D:\typora_import_images\typora-user-images\image-20220303111505681.png)



### 工厂模式

![image-20220304195643221](D:\typora_import_images\typora-user-images\image-20220304195643221.png)

#### 简单工厂模式

+ 引入

  ![image-20220303114749238](D:\typora_import_images\typora-user-images\image-20220303114749238.png)

  ![image-20220303114851119](D:\typora_import_images\typora-user-images\image-20220303114851119.png)

  ![image-20220303114841301](D:\typora_import_images\typora-user-images\image-20220303114841301.png)

  ![image-20220303120337925](D:\typora_import_images\typora-user-images\image-20220303120337925.png)

  

  

  

+ 介绍

  ![image-20220303120600191](D:\typora_import_images\typora-user-images\image-20220303120600191.png)

  ![image-20220304194812543](D:\typora_import_images\typora-user-images\image-20220304194812543.png)
  
  ```java
  /*
  // 等多代码实现 片段看源码
   // 用于创建pizza类型的简单工厂（简单工厂可以用于创建一系列对象，如鞋子等，这里创建的就是pizza）
   
   public class SimpleFactory {
      private Pizza pizza;
      public Pizza createPizza(String orderType){
          System.out.println("使用简单工厂模式");
          if(orderType.equals("greek")){
              pizza = new GreekPizza("greek");
          }else if(orderType.equals("cheese")){
              pizza = new CheesePizza("cheese");
          }else if(orderType.equals("spicy")){
              pizza = new SpicyPizza("spicy");
          }
          return pizza;
      }
  }
  */
  ```
  
  



#### 工厂方法模式

+ 引入

  ![image-20220304155451082](D:\typora_import_images\typora-user-images\image-20220304155451082.png)

  ![image-20220304164417144](D:\typora_import_images\typora-user-images\image-20220304164417144.png)
  
  

+ 工厂方法模式

  ```java
  /*
  // 实现片段  
  // 工厂方法模式 让子类实现该抽象方法，并其子类实现该方法，然后根据动态绑定机制创建适当类型的披萨
  
   public abstract class OrderPizza {
  
  
      private Pizza pizza; // 创建的pizza对象
  
      public OrderPizza() {
          do {
              String orderType = null;
              orderType = getType();
              pizza = createPizza(orderType); // 调用子类工厂方法
              if (pizza != null) {
                  pizza.prepare();
                  pizza.bake();
                  pizza.box();
                  pizza.cut();
              } else {
                  System.out.println("没有此pizza");
                  break;
              }
  
          } while (true);
      }
  
      // 工厂方法模式 让子类实现该抽象方法，并其子类实现该方法，然后根据动态绑定机制创建适当类型的披萨
      public abstract Pizza createPizza(String orderType);
  
      private String getType() {
          BufferedReader input = new BufferedReader(new InputStreamReader(System.in));
          System.out.println("input pizza type");
          try {
              String s = input.readLine();
              return s;
          } catch (IOException e) {
              e.printStackTrace();
              return "";
          }
      }
  }
  */
  ```

  

#### 抽象工厂模式

+ 介绍

  ![image-20220304191326619](D:\typora_import_images\typora-user-images\image-20220304191326619.png)

  ![image-20220304191729010](D:\typora_import_images\typora-user-images\image-20220304191729010.png)

  

  

+ 主要实现

  ```java
  /*
  
  public class OrderPizza {
      AbstractFactory factory;
      public void factory(AbstractFactory factory){
          Pizza pizza = null;
          String orderType = "";
          this.factory= factory;
          do {
              orderType = getType();
              pizza = factory.createPizza(orderType);
              if (pizza != null) {
                  pizza.bake();
                  pizza.box();
                  pizza.cut();
              } else {
                  System.out.println("没有此pizza");
                  break;
              }
  
          } while (true);
      }
      private String getType() {
          BufferedReader input = new BufferedReader(new InputStreamReader(System.in));
          System.out.println("input pizza type");
          try {
              String s = input.readLine();
              return s;
          } catch (IOException e) {
              e.printStackTrace();
              return "";
          }
      }
  }
  */
  ```

  





### 原型模式

+ 引入

  ![image-20220305100000037](D:\typora_import_images\typora-user-images\image-20220305100000037.png)

  ```java
  /*
   // 传统方法
   public static void main(String[] args) {
          Sheep sheep = new Sheep("tom", 1, "白色");
          Sheep sheep1 = new Sheep(sheep.getName(), sheep.getAge(), sheep.getColor());
          Sheep sheep2 = new Sheep(sheep.getName(), sheep.getAge(), sheep.getColor());
          Sheep sheep3 = new Sheep(sheep.getName(), sheep.getAge(), sheep.getColor());
          Sheep sheep4 = new Sheep(sheep.getName(), sheep.getAge(), sheep.getColor());
          Sheep sheep5 = new Sheep(sheep.getName(), sheep.getAge(), sheep.getColor());
  
          System.out.println(sheep);
          System.out.println(sheep1);
          System.out.println(sheep2);
          System.out.println(sheep3);
          System.out.println(sheep4);
          System.out.println(sheep5);
      }
  */
  ```

  

  ![image-20220305100731903](D:\typora_import_images\typora-user-images\image-20220305100731903.png)

  



+ 介绍

  ![image-20220305101011281](D:\typora_import_images\typora-user-images\image-20220305101011281.png)

  ![image-20220305101114632](D:\typora_import_images\typora-user-images\image-20220305101114632.png)

  

+ 实现

  ```java
  /*
   原型模式(克隆) ，主要用到了java提供的Cloneable接口，通过实现该方法，完成克隆，有效减少代码量，提高了程序的运行效率和可维护性(此方法在类添加了额外的属性时，不需要使用太多修改即可完成克隆)
   注意
   	如果使用默认方式克隆，则会克隆一个该调用对象的实例对象
   
   // 原型模式写法
   public class Sheep implements Cloneable {
      private String name;
      private int age;
      private String color;
  
      public Sheep(String name, int age, String color) {
          this.name = name;
          this.age = age;
          this.color = color;
      }
  
      // 克隆该实例，使用默认的clone来完成，(默认指，使用原有属性克隆)
      @Override
      protected Sheep clone()  {
          Sheep sheep = null;
          try {
              sheep =(Sheep)super.clone();
          } catch (CloneNotSupportedException e) {
              e.printStackTrace();
          }
          return sheep;
      }
  
      @Override
      public String toString() {
          return "Sheep{" +
                  "name='" + name + '\'' +
                  ", age=" + age +
                  ", color='" + color + '\'' +
                  '}';
      }
  }
  
  ==========================================
  public class Client {
      public static void main(String[] args) {
          Sheep sheep = new Sheep("tom", 1, "白色");
         Sheep sheep1 = sheep.clone(); // 调用sheep.clone()克隆一个sheep实例对象
         Sheep sheep2 = sheep.clone();
         Sheep sheep3 = sheep.clone();
         Sheep sheep4 = sheep.clone();
          System.out.println(sheep);
          System.out.println(sheep1);
          System.out.println(sheep2);
          System.out.println(sheep3);
          System.out.println(sheep4);
      }
  }
  */
  ```

  

+ 深拷贝

  ![image-20220305104210000](D:\typora_import_images\typora-user-images\image-20220305104210000.png)

  ![image-20220305104201121](D:\typora_import_images\typora-user-images\image-20220305104201121.png)

  ![image-20220305104425218](D:\typora_import_images\typora-user-images\image-20220305104425218.png)

  ```java
  /*
   实现了cloneable接口，重写其方法后，默认是浅拷贝，即实例对象中的简单数据类型可以正常复制，复杂数据类型只能拷贝其引用，当该拷贝的引用修改后，会影响全部的克隆对象
    (clone)深克隆策略
    	先进行默认克隆，然后将包含引用类型的数据在进行一次默认克隆（String可以不处理，因为其本质是不可变数据类型）
    (serialize)序列化深克隆策略(推荐使用)
      序列化的对象会默认进行深克隆，可以依照此特性完成深克隆
      
   实现
   	public class DeepClone implements Serializable,Cloneable {
      public String name;
      public DeepCloneableTarget target;
  
      public DeepClone(String name, DeepCloneableTarget target) {
          this.name = name;
          this.target = target;
      }
  
      @Override
      public String toString() {
          return "DeepClone{" +
                  "name='" + name + '\'' +
                  ", target=" + target +
                  '}';
      }
  
      // 深克隆方式一 使用clone方法
      @Override
      protected DeepClone clone()  {
          DeepClone deep = null;
          try {
              // 深克隆方法
              // 先进行默认克隆
              deep = (DeepClone) super.clone();
              // 将引用类型进行单独克隆
              deep.target = target.clone();
          } catch (CloneNotSupportedException e) {
              e.printStackTrace();
          }
          //deep
          return deep;
      }
  
      // 克隆方式二 使用 序列化实现深拷贝（推荐使用）
      public DeepClone deepClone(){
  
          ByteArrayOutputStream bos = null; // 字节数组输出流
          ObjectOutputStream oos = null; // 序列化流
          ByteArrayInputStream bis = null; // 字节数组输入流
          ObjectInputStream ois = null; // 反序列化流
  
          try {
  
              // 序列化
              bos = new ByteArrayOutputStream(); // 创建字节数组输出流
              oos = new ObjectOutputStream(bos); // 将序列化对象存储到 字节字节数组中(该数组在内存中)
              oos.writeObject(this); // 把当前对象序列化到字节数组输出流中
  
              // 反序列化
              bis = new ByteArrayInputStream( bos.toByteArray()); // 填入反序列化字节数组
              ois = new ObjectInputStream(bis);// 把字节数组输出流中的数据反序列化
              DeepClone deep = (DeepClone)ois.readObject();  // 反序列化过程中jvm会自动完成对象的深克隆
              return  deep;
          } catch (Exception e) {
              e.printStackTrace();
          }finally{
  
              // 关闭流
              try {
                  bos.close();
                  oos.close();
                  bis.close();
                  ois.close();
              } catch (IOException e) {
                  e.printStackTrace();
              }
          }
  
          return null;
      }
  }
  
  ==========================================================
  public class Client {
      public static void main(String[] args){
          DeepClone deep = new DeepClone("1",new DeepCloneableTarget("1","2"));
  
          // 第一种方式
  //        DeepClone clone1 = deep.clone();
  //        DeepClone clone2 = deep.clone();
  //        DeepClone clone3 = deep.clone();
  //        DeepClone clone4 = deep.clone();
  //        System.out.println(clone1+"_"+clone1.target.hashCode());
  //        System.out.println(clone2+"_"+clone2.target.hashCode());
  //        System.out.println(clone3+"_"+clone3.target.hashCode());
  //        System.out.println(clone4+"_"+clone4.target.hashCode());
  
          // 第二种方式
          DeepClone clone1 = deep.deepClone();
          DeepClone clone2 = deep.deepClone();
          DeepClone clone3 = deep.deepClone();
          DeepClone clone4 = deep.deepClone();
          System.out.println(clone1+"_"+clone1.target.hashCode());
          System.out.println(clone2+"_"+clone2.target.hashCode());
          System.out.println(clone3+"_"+clone3.target.hashCode());
          System.out.println(clone4+"_"+clone4.target.hashCode());
      }
  }
  */
  ```

  ![image-20220305123813990](D:\typora_import_images\typora-user-images\image-20220305123813990.png)



### 建造者模式

+ **建造者模式主要思想就是把，一个事情进行拆分(拆分成多个对象)，降低类的耦合性**，(如以下实例，就是将建房子拆分成多个类，一个是提供规模的(抽象类)，一个指挥造房子的(为了添加抽象层，降低类的耦合性)),**使用方在使用时只用调用最少的函数，就能完成功能(细节都有提供方完成)（满足ocp原则）**

+ 引入

  ![image-20220305141755501](D:\typora_import_images\typora-user-images\image-20220305141755501.png)

  ```java
  /*
   // 传统方法解决
   
   public abstract class AbstractHouse {
      public abstract void buildBasic();
      public abstract void buildWalls();
      public abstract void roofed();
  
      public void build(){
          buildBasic();
          buildWalls();
          roofed();
      }
  
  }
  ============================
  
  public class CommonHouse extends AbstractHouse{
      @Override
      public void buildBasic() {
          System.out.println("普通房子打地基");
      }
  
      @Override
      public void buildWalls() {
          System.out.println("不同房子制作墙");
      }
  
      @Override
      public void roofed() {
          System.out.println("普通房子砌砖");
      }
  }
  
  */
  ```

  ![image-20220305143007979](D:\typora_import_images\typora-user-images\image-20220305143007979.png)

  

  

+ 介绍

  ![image-20220305143123612](D:\typora_import_images\typora-user-images\image-20220305143123612.png)

  ![image-20220305143515976](D:\typora_import_images\typora-user-images\image-20220305143515976.png)

  ![image-20220305144149368](D:\typora_import_images\typora-user-images\image-20220305144149368.png)

  

  ```java
  /*
   实现
   	public abstract class HouseBuilder {
      protected House house = new House();
  
      public abstract  void buildBasic();
      public abstract  void buildWalls();
      public abstract  void rooted();
  
      public House buildHouse(){
  
          return house;
      }
  
  }
  
  =========================
  public class House {
      public String basic;
      public String wall;
      public String rooted;
  }
  =========================
  public class CommonHouse extends  HouseBuilder{
      @Override
      public void buildBasic() {
          System.out.println("普通房子大地基5米");
      }
  
      @Override
      public void buildWalls() {
          System.out.println("普通房子砌墙10cm");
      }
  
      @Override
      public void rooted() {
          System.out.println("普通房子屋顶");
      }
  }
  
  
  
  =============================
  public class MagnificentHouse extends HouseBuilder{
      @Override
      public void buildBasic() {
          System.out.println("高楼 打地基100米");
      }
  
      @Override
      public void buildWalls() {
          System.out.println("高楼 砌墙2米");
      }
  
      @Override
      public void rooted() {
          System.out.println("高楼 房顶30米");
      }
  }
  
  ================================
  public class HouseDirector {
      private HouseBuilder houseBuilder = null;
  
      public HouseDirector(HouseBuilder houseBuilder) {
          this.houseBuilder = houseBuilder;
      }
  
      public void setHouseBuilder(HouseBuilder houseBuilder) {
          this.houseBuilder = houseBuilder;
      }
  
      // 指挥者建造房子
      public House constructHouse(){
          houseBuilder.buildBasic();
          houseBuilder.buildWalls();
          houseBuilder.rooted();
          return houseBuilder.buildHouse();
      }
  }
  =============================
  public class Client {
      public static void main(String[] args){
          CommonHouse commonHouse = new CommonHouse();
          HouseDirector houseDirector = new HouseDirector(commonHouse);
          House house = houseDirector.constructHouse();
          System.out.println(house);
  
          MagnificentHouse magnificentHouse = new MagnificentHouse();
          HouseDirector houseDirector1 = new HouseDirector(magnificentHouse);
          houseDirector1.constructHouse();
  
      }
  }
  
  */
  ```

  ![image-20220305152152097](D:\typora_import_images\typora-user-images\image-20220305152152097.png)

  ![image-20220305152610479](D:\typora_import_images\typora-user-images\image-20220305152610479.png)

  




## 1.3 结构型模式

### 适配器模式

+ 适配器模式思想

  **将一个不符合要求的类，通过抽象层处理为符合要求的类**

+ 引入

  ![image-20220305154329703](D:\typora_import_images\typora-user-images\image-20220305154329703.png)

  ![image-20220305155017493](D:\typora_import_images\typora-user-images\image-20220305155017493.png)

  

  

#### 类适配器模式

+ 介绍

  ![image-20220305163404992](D:\typora_import_images\typora-user-images\image-20220305163404992.png)

  ![image-20220305163825872](D:\typora_import_images\typora-user-images\image-20220305163825872.png)

  

  ```java
  /*
   public interface IVoltage5V {
      int output5V();
  }
  ==================================
  public class Voltage220V {
      public int output220V(){
          int src = 220;
          System.out.println("电压="+src+"V");
          return src;
      }
  }
  ================================
  public class VoltageAdapter extends Voltage220V implements IVoltage5V{
      @Override
      public int output5V() {
          int srcV = output220V();
          int destV = srcV / 44;
          return destV;
      }
  }
  ================================
  public class Phone {
      public void charging (IVoltage5V iVoltage5V){
          if(iVoltage5V.output5V()==5){
              System.out.println("电压为5V，开始充电~~");
          }else if(iVoltage5V.output5V() >5){
              System.out.println("电压过高，请处理");
          }else{
              System.out.println("错误");
          }
      }
  }
  ===============================
  public class Client {
      public static void main(String[] args){
          System.out.println("类适配器模式");
          Phone phone = new Phone();
          phone.charging(new VoltageAdapter());
      }
  }
  
  */
  ```

  

  ![image-20220305164737931](D:\typora_import_images\typora-user-images\image-20220305164737931.png)

  

  

#### 对象适配模式

+ **此模式常用**

+ 介绍

  ![image-20220305165154410](D:\typora_import_images\typora-user-images\image-20220305165154410.png)

  ![image-20220305165307496](D:\typora_import_images\typora-user-images\image-20220305165307496.png)

  ![image-20220305165613802](D:\typora_import_images\typora-user-images\image-20220305165613802.png)

  ```java
  /*
   public interface IVoltage5V {
      int output5V();
  }
  ==================================
  public class VoltageAdapter  implements IVoltage5V {
      private Voltage220V voltage220V;
  
      public VoltageAdapter(Voltage220V voltage220V) {
          this.voltage220V = voltage220V;
      }
  
      public Voltage220V getVoltage220V() {
          return voltage220V;
      }
  
      public void setVoltage220V(Voltage220V voltage220V) {
          this.voltage220V = voltage220V;
      }
  
      @Override
      public int output5V() {
          int det = 0;
          if(voltage220V != null){
              int src = voltage220V.output220V();
              det = src / 44;
              System.out.println("适配完成");
          }
          return det;
      }
  }
  =====================================
  public class Voltage220V {
      public int output220V(){
          int src = 220;
          System.out.println("电压="+src+"V");
          return src;
      }
  }
  =====================================
  public class Phone {
      public void charging (IVoltage5V iVoltage5V){
          if(iVoltage5V.output5V()==5){
              System.out.println("电压为5V，开始充电~~");
          }else if(iVoltage5V.output5V() >5){
              System.out.println("电压过高，请处理");
          }else{
              System.out.println("错误");
          }
      }
  }
  ======================================
  public class Client {
      public static void main(String[] args){
          System.out.println("类适配器模式");
          Phone phone = new Phone();
          phone.charging(new VoltageAdapter(new Voltage220V()));
      }
  }
  */
  ```

  ![image-20220305170657629](D:\typora_import_images\typora-user-images\image-20220305170657629.png)

  

  

#### 接口适配模式

+ 介绍

  ![image-20220305171135150](D:\typora_import_images\typora-user-images\image-20220305171135150.png)

  ![image-20220305171444167](D:\typora_import_images\typora-user-images\image-20220305171444167.png)

  

  

### 桥接模式

+ 引入

  ![image-20220309213426155](D:\typora_import_images\typora-user-images\image-20220309213426155.png)

  ![image-20220309213609746](D:\typora_import_images\typora-user-images\image-20220309213609746.png)

  ![image-20220309213722305](D:\typora_import_images\typora-user-images\image-20220309213722305.png)

  

+ 介绍

  ![image-20220310102806907](D:\typora_import_images\typora-user-images\image-20220310102806907.png)

  ![image-20220310103117953](D:\typora_import_images\typora-user-images\image-20220310103117953.png)

  

+ 实现

  ![image-20220310103748198](D:\typora_import_images\typora-user-images\image-20220310103748198.png)

  ```java
  /*
  public interface Brand {
      void open();
      void close();
      void call();
  }
  ==================================
  public class Client {
      public static void main(String[] args) {
          FoldedPhone phone1 = new FoldedPhone(new XiaoMi());
          phone1.open();
          phone1.close();
          phone1.call();
          FoldedPhone phone2 = new FoldedPhone(new Vivo());
          phone2.open();
          phone2.close();
          phone2.call();
  
          UprightPhone phone3 = new UprightPhone(new Vivo());
          phone3.open();
          phone3.close();
          phone3.call();
      }
  }
  =====================================
  public class FoldedPhone extends Phone {
  
      public FoldedPhone(Brand brand) {
          super(brand);
      }
  
      public void open() {
          System.out.println("折叠手机打开了");
          super.open();
      }
  
      public void close() {
          super.close();
          System.out.println("折叠手机关闭了");
      }
  
      public void call() {
          super.call();
          System.out.println("折叠手机打电话了");
      }
  }
  ==========================================
  public abstract class Phone {
      private Brand brand;
  
      public Phone(Brand brand) {
          this.brand = brand;
      }
  
      protected void open(){
          this.brand.open();
      }
      protected void close(){
          this.brand.close();
      }
      protected  void call(){
          this.brand.call();
      }
  }
  ===========================================
  public class UprightPhone extends Phone {
      public UprightPhone(Brand brand) {
          super(brand);
      }
  
      @Override
      protected void open() {
          System.out.println("直立式手机");
          super.open();
      }
  
      @Override
      protected void close() {
          System.out.println("直立式手机");
          super.close();
      }
  
      @Override
      protected void call() {
          System.out.println("直立式手机");
          super.call();
      }
  }
  =====================================
  public class Vivo implements  Brand{
      public Vivo() {
      }
  
      @Override
      public void open() {
          System.out.println("Vio 书籍开打了");
      }
  
      @Override
      public void close() {
          System.out.println("Vivo 手机关闭了");
      }
  
      @Override
      public void call() {
          System.out.println("Vio 手机打电话");
      }
  }
  ==========================================
  public class XiaoMi implements Brand {
      @Override
      public void open() {
          System.out.println("小米手机开机了");
      }
  
      @Override
      public void close() {
          System.out.println("小米手机关闭了");
      }
  
      @Override
      public void call() {
          System.out.println("小米手机打电话");
      }
  }
  */
  ```

  ![image-20220310112418884](D:\typora_import_images\typora-user-images\image-20220310112418884.png)

  ![image-20220310112636784](D:\typora_import_images\typora-user-images\image-20220310112636784.png)

  

  

  

### 装饰器模式(?)

![image-20220324092047619](D:\typora_import_images\typora-user-images\image-20220324092047619.png)



+ 引入

  ![image-20220310113459244](D:\typora_import_images\typora-user-images\image-20220310113459244.png)

  ![image-20220310113730821](D:\typora_import_images\typora-user-images\image-20220310113730821.png)

  ![image-20220310114022963](D:\typora_import_images\typora-user-images\image-20220310114022963.png)

  

  ![image-20220310114150075](D:\typora_import_images\typora-user-images\image-20220310114150075.png)

  ![image-20220310114844797](D:\typora_import_images\typora-user-images\image-20220310114844797.png)

  

  

  

  

  

+ 装饰者模式

  ![image-20220310115545288](D:\typora_import_images\typora-user-images\image-20220310115545288.png)

  ![image-20220310115717374](D:\typora_import_images\typora-user-images\image-20220310115717374.png)

  ![image-20220310120318230](D:\typora_import_images\typora-user-images\image-20220310120318230.png)

  ![image-20220310120503567](D:\typora_import_images\typora-user-images\image-20220310120503567.png)

  

  ![image-20220328092255280](D:\typora_import_images\typora-user-images\image-20220328092255280.png)

  

  

  

  

  

+ 实现

  ```java
  /*
   public abstract class Drink {
      private String des;
      private float price;
  
      public void setDes(String des) {
          this.des = des;
      }
  
      public String getDes() {
          return des;
      }
  
      public float getPrice() {
          return price;
      }
  
      public void setPrice(float price) {
          this.price = price;
      }
  
      public abstract float cost();
  }
  =============================================
  public class Decorator extends Drink {
  
  
      private Drink obj;
  
      public Decorator(Drink obj) {
          this.obj = obj;
      }
  
      @Override
      public float cost() {
          return super.getPrice() + obj.cost();
      }
  
      @Override
      public String getDes() {
          return super.getDes() + " " + super.getPrice() + "&&" + obj.getDes();
      }
  }
  ==============================================
  public class Chocolate extends Decorator {
      public Chocolate(Drink obj) {
          super(obj);
          setDes("巧克力");
          setPrice(3.0f);
      }
  
  }
  ==============================================
  public class Coffee extends Drink {
      @Override
      public float cost() {
          return super.getPrice();
      }
  }
  ===============================================
  public class CoffeeBar {
      public static void main(String[] args) {
          Drink order = new LongBlack();
  
          System.out.println(order.cost());
          System.out.println(order.getDes());
          order = new Milk(order);
          System.out.println(order.getDes());
          System.out.println(order.cost());
          order = new Chocolate(order);
          System.out.println(order.getDes());
          System.out.println(order.cost());
  
      }
  }
  ==================================================
  public class Espresso extends Coffee {
      public Espresso() {
          setDes("意大利咖啡");
          setPrice(6.0f);
      }
  
  }
  ==================================================
  public class LongBlack extends  Coffee{
      public LongBlack() {
          setDes("long black");
          setPrice(5.0f);
      }
  }
  ===================================================
  public class Milk extends  Decorator{
      public Milk(Drink obj) {
          super(obj);
          setDes("牛奶");
          setPrice(2.0f);
      }
  }
  
  */
  ```

  



### 组合模式

+ 引入

  ![image-20220310192808947](D:\typora_import_images\typora-user-images\image-20220310192808947.png)

  ![image-20220310194327138](D:\typora_import_images\typora-user-images\image-20220310194327138.png)

  



+ 介绍

  ![image-20220310194405491](D:\typora_import_images\typora-user-images\image-20220310194405491.png)

  ![image-20220310195013531](D:\typora_import_images\typora-user-images\image-20220310195013531.png)

  ![image-20220310195027266](D:\typora_import_images\typora-user-images\image-20220310195027266.png)

  

  ![image-20220310203604041](D:\typora_import_images\typora-user-images\image-20220310203604041.png)

  

  ```java
  /*
   public class Client {
      public static void main(String[] args) {
  
          Organization u1 = new University("清华大学", "好大学");
          Organization c1 = new College("计算机学院", "好学院");
  
          c1.add(new Department("软件工程", "好专业"));
          c1.add(new Department("计算机科学与技术", "优秀专业"));
          u1.add(c1);
          u1.print();
          c1.print();
      }
  }
  =================================
  public class College extends Organization{
      List<Organization> organizations = new ArrayList<>();
  
      public College(String name, String des) {
          super(name, des);
      }
  
      @Override
      protected void add(Organization organization) {
          organizations.add(organization);
      }
  
      @Override
      protected void remove(Organization organization) {
          organizations.remove(organization);
      }
  
      @Override
      protected void print() {
          System.out.println("========== "+getName()+" ==========");
          for (Organization organization : organizations) {
              System.out.println(organization);
          }
      }
  }
  ========================================
  public class Department extends Organization{
      public Department(String name, String des) {
          super(name, des);
      }
  
      @Override
      public String getName() {
          return super.getName();
      }
  
      @Override
      public String getDes() {
          return super.getDes();
      }
  
      @Override
      protected void print() {
          System.out.println(getName());
      }
  }
  ================================================
  public abstract class Organization {
      private String name;
      private String des;
  
      protected void add(Organization organization) {
          throw new UnsupportedOperationException();
      }
  
  	// 此方式可以无污染的给子类继续重写(throw new UnsupportedOperationException()会抛出一个运行异常)
      protected void remove(Organization organization) {
          throw new UnsupportedOperationException();
      }
  
      public String getName() {
          return name;
      }
  
      public void setName(String name) {
          this.name = name;
      }
  
      public String getDes() {
          return des;
      }
  
      @Override
      public String toString() {
          return "Organization{" +
                  "name='" + name + '\'' +
                  ", des='" + des + '\'' +
                  '}';
      }
  
      public void setDes(String des) {
          this.des = des;
      }
  
      public Organization(String name, String des) {
          this.name = name;
          this.des = des;
      }
  
      protected abstract void print();
  }
  
  =============================================
  public class University extends Organization{
      List<Organization> organizations = new ArrayList<>();
  
      public University(String name, String des) {
          super(name, des);
      }
  
      @Override
      protected void add(Organization organization) {
          organizations.add(organization);
      }
  
      @Override
      protected void remove(Organization organization) {
          organizations.remove(organization);
      }
  
      @Override
      protected void print() {
          System.out.println("========== "+getName()+" ==========");
          for (Organization organization : organizations) {
              System.out.println(organization);
          }
      }
  }
  */
  ```

  

  ![image-20220310212508636](D:\typora_import_images\typora-user-images\image-20220310212508636.png)





### 外观模式

+ 引入

  ![image-20220311201024628](D:\typora_import_images\typora-user-images\image-20220311201024628.png)

  ![image-20220311201042454](D:\typora_import_images\typora-user-images\image-20220311201042454.png)

  ![image-20220311201212558](D:\typora_import_images\typora-user-images\image-20220311201212558.png) 

  

  

  



+ 基本介绍

  ![image-20220311201429639](D:\typora_import_images\typora-user-images\image-20220311201429639.png)

  ![image-20220311202122305](D:\typora_import_images\typora-user-images\image-20220311202122305.png)

  

  ```java
  /*
   public class Client {
      public static void main(String[] args){
          TheaterFacade theaterFacade = new TheaterFacade();
          theaterFacade.ready();
          theaterFacade.play();
      }
  }
  ======================================
  public class DVDPlayer {
      private static DVDPlayer dvdPlayer = new DVDPlayer();
  
      public static DVDPlayer getDVDPlayer(){
          return dvdPlayer;
      }
      
      public void on(){
          System.out.println("dvd on");
      }
      public void off(){
          System.out.println("dvd off");
      }
      public void play(){
          System.out.println("dvd play");
      }
  
  }
  ===============================================
  public class Popcorn {
          private static Popcorn popcorn = new Popcorn();
  
          public static Popcorn getPopcorn(){
              return popcorn;
          }
  
          public void on(){
              System.out.println("popcorn on");
          }
          public void off(){
              System.out.println("popcorn off");
          }
          public void pop(){
              System.out.println("popcorn pop");
          }
  }
  ===================================================
  public class Projector {
      private static Projector projector = new Projector();
  
      public static Projector getProjector(){
          return projector;
      }
  
      public void on(){
          System.out.println("projector on");
      }
      public void off(){
          System.out.println("projector off");
      }
      public void projector(){
          System.out.println("projector running");
      }
  }
  =====================================================
  public class Screen {
      private static Screen screen = new Screen();
  
      public static Screen getScreen(){
          return screen;
      }
  
      public void on(){
          System.out.println("screen on");
      }
      public void off(){
          System.out.println("screen off");
      }
      public void rotate(){
          System.out.println("screen rotate");
      }
  }
  ========================================================
  public class Stereo {
      private static Stereo stereo = new Stereo();
  
      public static Stereo getStereo(){
          return stereo;
      }
  
      public void on(){
          System.out.println("stereo on");
      }
      public void off(){
          System.out.println("stereo off");
      }
      public void up(){
          System.out.println("stereo up");
      }
  }
  ========================================================
  public class Theater {
      private static Theater theater = new Theater();
  
      public static Theater getStereo(){
          return theater;
      }
  
      public void on(){
          System.out.println("theater on");
      }
      public void off(){
          System.out.println("theater off");
      }
      public void bright(){
          System.out.println("theater bright");
      }
  }
  ===========================================================
  public class TheaterFacade {
      private Theater theater ;
      private Popcorn popcorn;
      private Stereo stereo;
      private Projector projector;
      private Screen screen;
      private DVDPlayer dvdPlayer;
  
      public TheaterFacade() {
          theater = Theater.getStereo();
          popcorn = Popcorn.getPopcorn();
          stereo = Stereo.getStereo();
          projector = Projector.getProjector();
          screen = Screen.getScreen();
          dvdPlayer = DVDPlayer.getDVDPlayer();
      }
  
      public void ready(){
          popcorn.on();
          popcorn.pop();
          screen.rotate();
          projector.on();
          stereo.on();
          dvdPlayer.on();
          theater.bright();
      }
      public static void main(String[] args){
  
      }
  
      public void play(){
          dvdPlayer.play();
      }
      public void end(){
          dvdPlayer.off();
      }
  }
  */
  ```

  

  ![image-20220311210646737](D:\typora_import_images\typora-user-images\image-20220311210646737.png)





### 享元模式

+ 引入

  ![image-20220312111223493](D:\typora_import_images\typora-user-images\image-20220312111223493.png)

  ![image-20220312111302926](D:\typora_import_images\typora-user-images\image-20220312111302926.png)

  ![image-20220312111408889](D:\typora_import_images\typora-user-images\image-20220312111408889.png)

  

  

+ 介绍

  ![image-20220312111829915](D:\typora_import_images\typora-user-images\image-20220312111829915.png)

  ![image-20220312112328928](D:\typora_import_images\typora-user-images\image-20220312112328928.png)

  ![image-20220312112353113](D:\typora_import_images\typora-user-images\image-20220312112353113.png)

  

  

  

+ 实现

  ![image-20220312112541294](D:\typora_import_images\typora-user-images\image-20220312112541294.png)

  

  

+ ```java
  /*
   public class Client {
      public static void main(String[] args) {
          WebSiteFactory factory = new WebSiteFactory();
          WebSite web1 = factory.getWebSiteCategory("新闻");
          User user = new User();
          user.setName("张三");
          User user1 = new User();
          user1.setName("李四");
          web1.use(user);
          WebSite web2 = factory.getWebSiteCategory("游戏");
          web2.use(user1);
          System.out.println(factory.getWebSiteCount());
      }
  }
  ==================================
  public class ConcreteWebSite extends WebSite {
      private String type = "";
  
      public ConcreteWebSite(String type) {
          this.type = type;
      }
  
      @Override
      public void use(User user) {
          System.out.println("网站的发布形式为：" + type+"，使用者："+user.getName());
      }
  }
  =======================================
  public class User {
      private String name;
  
      public String getName() {
          return name;
      }
  
      public void setName(String name) {
          this.name = name;
      }
  }
  =========================================
  public abstract class WebSite {
      public abstract  void use(User user);
  }
  ===========================================
  public class WebSiteFactory {
  
      // 充当池的作用
      private HashMap<String, ConcreteWebSite> pool = new HashMap<>();
  
      public WebSite getWebSiteCategory(String type) {
          if (!pool.containsKey(type)) {
              pool.put(type, new ConcreteWebSite(type));
          }
          return (WebSite) pool.get(type);
      }
  
      public int getWebSiteCount(){
          return pool.size();
      }
  }
  ==============================================
  */
  ```

  ![image-20220312115512437](D:\typora_import_images\typora-user-images\image-20220312115512437.png)

  



### 代理模式

+ 引入

  ![image-20220312120100063](D:\typora_import_images\typora-user-images\image-20220312120100063.png)

  ![image-20220312120632048](D:\typora_import_images\typora-user-images\image-20220312120632048.png)

  

#### 静态代理

+ 介绍

  ![image-20220312120913855](D:\typora_import_images\typora-user-images\image-20220312120913855.png)

  

  

+ 实现

  ```java
  /*
   public class Client {
      public static void main(String[] args){
          TeacherDAO teacherDAO = new TeacherDAO();
          TeacherDAOProxy teacherDAOProxy = new TeacherDAOProxy(teacherDAO);
          teacherDAOProxy.teach();
      }
  }
  =================================
  public interface ITeacherDAO {
      void teach();
  }
  =================================
  public class TeacherDAO implements ITeacherDAO{
      @Override
      public void teach() {
          System.out.println("老师授课中");
      }
  }
  ====================================
  public class TeacherDAOProxy implements ITeacherDAO{
  
      private ITeacherDAO target;
  
      public TeacherDAOProxy(ITeacherDAO target) {
          this.target = target;
      }
  
      @Override
      public void teach() {
          System.out.println("代理开始");
          target.teach();
          System.out.println("代理结束");
      }
  }
  */
  ```

  



#### 动态代理

+ 介绍

  ![image-20220312122750305](D:\typora_import_images\typora-user-images\image-20220312122750305.png)

  ![image-20220312145902806](D:\typora_import_images\typora-user-images\image-20220312145902806.png)

  

+ 实现

  ```java
  
   public class Client {
      public static void main(String[] args) {
          TeacherDAO target = new TeacherDAO();
          ITeacherDAO proxy = (ITeacherDAO) new ProxyFactory(target).getProxyInstance();
  
          // class com.sun.proxy.$Proxy0 , 内存中动态生成的代理对象
          System.out.println(proxy.getClass());
  
          // 当调用该方法时，实际上运行的是jdk代理中返回对象里的匿名内部类的方法体
          // xxx.teach()会作为该里面内部类的第二个参数 Method method ， 携带的参数会传入 Object[] args (第三个参数)中
          proxy.teach();
      }
  }
  ======================================
  public interface ITeacherDAO {
      void teach();
  }
  =======================================
  public class ProxyFactory {
  
      private Object target;
  
      public ProxyFactory(Object target) {
          this.target = target;
      }
  
  
      // 使用 jdkProxy代理类完成动态代理
      public Object getProxyInstance() {
          /**
           * public static Object newProxyInstance(ClassLoader loader,
           *                                           Class<?>[] interfaces,
           *                                           InvocationHandler h)
           * 该类需要传入三个参数
           * 1. loader 指定当前目标对象使用的类加载器，获得类加载器的方法
           * 2. Class<?>[] interfaces 目标对象实现的接口类型，使用泛型方法确认类型
           * 3、  InvocationHandler h ：事件处理，执行目标对象方法时，会触发事件处理器方法
           * 会把当前执行的目标对象方法作为参数传递
           * */
          return Proxy.newProxyInstance(target.getClass().getClassLoader(),
                  target.getClass().getInterfaces(),
                  new InvocationHandler() {
                      @Override
                      public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
                          // 此时methods方法中存储这 target类对象中 所有的方法。  Object[] args 为携带的参数
                          System.out.println("JDK代理开始");
                          Object invoke = method.invoke(target, args);
                          return invoke;
                      }
                  });
      }
  }
  ==========================================================
      public class TeacherDAO implements ITeacherDAO{
      @Override
      public void teach() {
          System.out.println("teacher is teaching");
      }
  }
  ```

  

#### Cglib代理

+ 介绍

  ![image-20220312153407712](D:\typora_import_images\typora-user-images\image-20220312153407712.png)

  ![image-20220312153743481](D:\typora_import_images\typora-user-images\image-20220312153743481.png)

  ![image-20220312154238192](D:\typora_import_images\typora-user-images\image-20220312154238192.png)

  ```java
  /*
   public class Client {
      public static void main(String[] args){
          TeacherDAO teacherDAO = new TeacherDAO();
          TeacherDAO proxy = (TeacherDAO)new ProxyFactory(teacherDAO).getProxyInstance(); // 返回cglib代理对象
          proxy.teach(); // 调用cglib代理对象，此时会去隐式调用 重写的 intercept方法
      }
  }
  =====================================
  public class ProxyFactory implements MethodInterceptor {
      private Object target; // 聚合一个目标对象
  
      public ProxyFactory(Object target) {
          this.target = target;
      }
  
      // 返回一个目标对象的代理对象
      public Object getProxyInstance(){
          // 创建一个工具类
          Enhancer enhancer = new Enhancer();
          // 设置父类
          enhancer.setSuperclass(target.getClass());
          // 设置回调函数
          enhancer.setCallback(this);
          // 创建子类对象，即代理对象
          return enhancer.create();
      }
  
      // 重写 intercept方法，会调用目标对象的方法(和jdk代理类似)
      @Override
      public Object intercept(Object o, Method method, Object[] objects, MethodProxy methodProxy) throws Throwable {
         System.out.println("cglib代理模式 启动了~~");
          Object returnValue = method.invoke(target, objects);
          return returnValue;
      }
  }
  ==============================================
  public class TeacherDAO {
      public void teach(){
          System.out.println("run teaching ~~ ! cglib代理 不需要实现接口");
      }
  }
  */
  ```
  
  
  
  

#### 其他代理

+ 防火墙代理

  ![image-20220312155941196](D:\typora_import_images\typora-user-images\image-20220312155941196.png)

  

## 1.4 行为型模式

### 模板模式

+ 引入

  ![image-20220312191601817](D:\typora_import_images\typora-user-images\image-20220312191601817.png)

+ 介绍

  ![image-20220312191715239](D:\typora_import_images\typora-user-images\image-20220312191715239.png)

  

  ![image-20220312192001433](D:\typora_import_images\typora-user-images\image-20220312192001433.png)

  



+ 实现

  ![image-20220312192611876](D:\typora_import_images\typora-user-images\image-20220312192611876.png)

  ```java
  /*
   public class Client {
      public static void main(String[] args){
          System.out.println("==============制作红豆豆浆==============");
          RedBeanSoyaMilk redBeanSoyaMilk = new RedBeanSoyaMilk();
          redBeanSoyaMilk.make();
            System.out.println("==============制作花生豆浆==============");
          PeanutSoyaMilk peanutSoyaMilk = new PeanutSoyaMilk();
          peanutSoyaMilk.make();
  
      }
  }
  =====================================
  public class PeanutSoyaMilk extends SoyaMilk{
      @Override
      void addCondiments() {
          System.out.println("加入花生");
      }
  }
  =====================================
  public class RedBeanSoyaMilk extends SoyaMilk{
      @Override
      void addCondiments() {
          System.out.println("加入红豆");
      }
  }
  ====================================
  public abstract class SoyaMilk {
  
      final void make(){
          select();
          addCondiments();
          soak();
          beat();
      }
      // 相同的操作可以直接由父类来封装，子类继承即可
      void select(){
          System.out.println("选择新鲜的黄豆");
      }
  
      // 添加的辅料有实现的子类实现
      abstract void addCondiments();
      void soak(){
          System.out.println("黄豆和配料开始浸泡");
      }
      
      void beat(){
          System.out.println("黄豆和配料再豆浆机打碎");
      }
  }
  */
  ```

  

+ 钩子方法

  ![image-20220312195053128](D:\typora_import_images\typora-user-images\image-20220312195053128.png)

  ```java
  public class Client {
      public static void main(String[] args){
          System.out.println("==============制作红豆豆浆==============");
          RedBeanSoyaMilk redBeanSoyaMilk = new RedBeanSoyaMilk();
          redBeanSoyaMilk.make();
            System.out.println("==============制作花生豆浆==============");
          PeanutSoyaMilk peanutSoyaMilk = new PeanutSoyaMilk();
          peanutSoyaMilk.make();
          System.out.println("==============制作纯豆浆==============");
          PureSoyaMilk pureSoyaMilk = new PureSoyaMilk();
          pureSoyaMilk.make();
  
      }
  }
  ==========================
  public class PeanutSoyaMilk extends SoyaMilk{
      @Override
      void addCondiments() {
          System.out.println("加入花生");
      }
  }
  ============================
  public class PureSoyaMilk extends SoyaMilk{
      @Override
      void addCondiments() {
  
      }
  
      // 此类为纯豆浆，不添加任何配料，所以可以重写父类的钩子方法完成操作
      @Override
      boolean wantAddCondiments() {
          return false;
      }
  }
  ================================
  public class RedBeanSoyaMilk extends SoyaMilk{
      @Override
      void addCondiments() {
          System.out.println("加入红豆");
      }
  }
  ================================
  public abstract class SoyaMilk {
  
      final void make(){
          select();
          // 钩子方法做判断，可以由子类完成重写，默认情况为true
          if(wantAddCondiments()){
              addCondiments();
          }
          soak();
          beat();
      }
      // 相同的操作可以直接由父类来封装，子类继承即可
      void select(){
          System.out.println("选择新鲜的黄豆");
      }
  
      // 添加的辅料有实现的子类实现
      abstract void addCondiments();
      void soak(){
          System.out.println("黄豆和配料开始浸泡");
      }
      
      void beat(){
          System.out.println("黄豆和配料再豆浆机打碎");
      }
  
      // 钩子方法 ，决定是否添加配料
      boolean wantAddCondiments(){
          return true;
      }
  }
  
  ```

  

  



### 命令模式

+ 引入

  ![image-20220312203026361](D:\typora_import_images\typora-user-images\image-20220312203026361.png)

  

+ 介绍

  ![image-20220312203119531](D:\typora_import_images\typora-user-images\image-20220312203119531.png)

  ![image-20220312203858349](D:\typora_import_images\typora-user-images\image-20220312203858349.png)

  

+ 实现

  ![image-20220312203948465](D:\typora_import_images\typora-user-images\image-20220312203948465.png)

  ![image-20220312204525793](D:\typora_import_images\typora-user-images\image-20220312204525793.png)

  

  ```java
  /*
   public class Client {
      public static void main(String[] args){
  
          // 使用命令模式。完成通过遥控器对电灯控制
  
          // 设置电灯的开关指令
          LightReceiver lightReceiver = new LightReceiver();
          LightOnCommand lightOnCommand = new LightOnCommand(lightReceiver);
          LightOffCommand lightOffCommand = new LightOffCommand(lightReceiver);
  
          // 拿到一个遥控器
          RemoteController remoteController = new RemoteController();
          // 设置第一行的按钮
          remoteController.setCommand(0,lightOnCommand,lightOffCommand);
  
          System.out.println("按下灯开的按钮");
          remoteController.onButtonWasPushed(0);
          System.out.println("按下灯关的按钮");
          remoteController.offButtonWasPushed(0);
          System.out.println("按下撤销按钮");
          remoteController.undoButtonWasPushed();
      }
  }
  ======================================================
  public interface Command {
      void execute();
      void undo();
  
  }
  ======================================================
  public class LightOffCommand implements Command {
      LightReceiver light;
  
      public LightOffCommand(LightReceiver light) {
          this.light = light;
      }
  
      @Override
      public void execute() {
          light.off();
      }
  
      @Override
      public void undo() {
          light.on();
      }
  }
  ===============================================================
  public class LightOnCommand implements Command {
  
      LightReceiver light;
  
      public LightOnCommand(LightReceiver light) {
          this.light = light;
      }
  
      @Override
      public void execute() {
          light.on();
      }
  
      @Override
      public void undo() {
          light.off();
      }
  }
  =================================================================
  public class LightReceiver {
      public void on(){
          System.out.println("电灯打开了...");
      }
      public void off(){
          System.out.println("电灯关闭了");
      }
  }
  ==============================================================
  public class NoCommand implements Command{
      @Override
      public void execute() {
  
      }
  
      @Override
      public void undo() {
  
      }
  }
  ===============================================================
  public class RemoteController {
      Command[] onCommands;
      Command[] offCommands;
  
      // 撤销命令
      Command undoCommand;
  
      // 初始化操作
      public RemoteController() {
          onCommands = new Command[5];
          offCommands = new Command[5];
          for (int i = 0; i < 5; i++) {
              onCommands[i] = new NoCommand();
              offCommands[i] = new NoCommand();
  
          }
      }
  
      // 给按钮设置需要的命令
      public void setCommand(int no,Command onCommand,Command offCommand){
          onCommands[no] = onCommand;
          offCommands[no] = offCommand;
      }
  
      //按下指定部分开的按钮
      public void onButtonWasPushed(int no){
          onCommands[no].execute();
          undoCommand = onCommands[no];
      }
      //按下指定部分关的按钮
      public void offButtonWasPushed(int no){
          offCommands[no].undo();
          undoCommand =  offCommands[no]; // 记录撤销按钮
      }
  
      public void undoButtonWasPushed(){
          undoCommand.undo();
      }
  
  }
  ==================================================================
  
  */
  ```
  
  ![image-20220313112434960](D:\typora_import_images\typora-user-images\image-20220313112434960.png)



### 访问者模式

+ 引入

  ![image-20220313112844417](D:\typora_import_images\typora-user-images\image-20220313112844417.png)

  ![image-20220313112855906](D:\typora_import_images\typora-user-images\image-20220313112855906.png)

  

+ 介绍

  ![image-20220313113207324](D:\typora_import_images\typora-user-images\image-20220313113207324.png)

  ![image-20220313113900293](D:\typora_import_images\typora-user-images\image-20220313113900293.png)

  ![image-20220313114118612](D:\typora_import_images\typora-user-images\image-20220313114118612.png)

  

  

+ 实现

  ![image-20220313114338338](D:\typora_import_images\typora-user-images\image-20220313114338338.png)

  ![image-20220313115717248](D:\typora_import_images\typora-user-images\image-20220313115717248.png)

  ![image-20220313115734394](D:\typora_import_images\typora-user-images\image-20220313115734394.png)

  

  ```java
  public class Client {
      public static void main(String[] args){
          ObjectStructure objectStructure = new ObjectStructure();
          objectStructure.attach(new Man());
          objectStructure.attach(new Woman());
  
          Success success = new Success();
          objectStructure.display(success);
          Fail fail = new Fail();
          objectStructure.display(fail);
          Wait wait = new Wait();
          objectStructure.display(wait);
      }
  }
  ============================================================
  public abstract class Action {
      public abstract void getManResult(Man man);
  
      public abstract  void getWomanResult(Woman woman);
  
  }
  =========================================================
  public class Success extends Action{
      @Override
      public void getWomanResult(Woman woman) {
          System.out.println("女人评价很好");
      }
  
      @Override
      public void getManResult(Man man) {
          System.out.println("男人评价很好");
      }
  }
  ======================================================
  public class Fail extends Action{
      @Override
      public void getManResult(Man man) {
          System.out.println("男人 评价 失败");
      }
  
      @Override
      public void getWomanResult(Woman woman) {
          System.out.println("女人 评价 失败");
  
      }
  }
  ====================================================
  public class Wait extends Action{
      @Override
      public void getManResult(Man man) {
          System.out.println("男人的凭借待定");
      }
  
      @Override
      public void getWomanResult(Woman woman) {
          System.out.println("女人的凭借待定");
  
      }
  }
  =====================================================
  public abstract class Person {
      public abstract  void accept(Action action);
  }
  ======================================================
  public class Man extends Person{
      @Override
      public void accept(Action action) {
          action.getManResult(this);
      }
  }
  ==================================================
      public class Woman extends  Person{
      @Override
      public void accept(Action action) {
          action.getWomanResult(this);
      }
  }
  ======================================================
  public class ObjectStructure {
  
      private List<Person> persons = new LinkedList<>();
  
      public void attach(Person p){
         persons.add(p);
      }
      public void detach(Person p){
          persons.remove(p);
      }
      public void display(Action action){
          for (Person person : persons) {
              person.accept(action);
          }
      }
  }
  ======================================================
  ```

  ![image-20220313120949483](D:\typora_import_images\typora-user-images\image-20220313120949483.png)

  

### 迭代器模式

+ 引入

  ![image-20220313121928423](D:\typora_import_images\typora-user-images\image-20220313121928423.png)

  ![image-20220313122016435](D:\typora_import_images\typora-user-images\image-20220313122016435.png)

  ![image-20220313122128799](D:\typora_import_images\typora-user-images\image-20220313122128799.png)

  

  

+ 介绍

  ![image-20220313122238262](D:\typora_import_images\typora-user-images\image-20220313122238262.png)

  ![image-20220313123452332](D:\typora_import_images\typora-user-images\image-20220313123452332.png)

  ![image-20220313151527878](D:\typora_import_images\typora-user-images\image-20220313151527878.png)

  

  

+ 实现

  ![image-20220313151900258](D:\typora_import_images\typora-user-images\image-20220313151900258.png)

  ```java
  public class Client {
      public static void main(String[] args){
          List<College> collegeList = new ArrayList<>();
          ComputerCollege computerCollege = new ComputerCollege();
          InfoCollege infoCollege = new InfoCollege();
  
          collegeList.add(computerCollege);
          collegeList.add(infoCollege);
  
          OutPutImpl outPut = new OutPutImpl(collegeList);
          outPut.printCollege();
      }
  }
  ====================================
  public interface College {
      String getName();
      void addDepartment(String name,String desc);
      Iterator createIterator();
  
  }
  =======================================
  public class ComputerCollege implements College {
  
      Department[] departments;
      int numOfDepartment = 0; // 保存当前数组对象个数
  
      @Override
      public String getName() {
          return "计算机学院";
      }
  
      public ComputerCollege() {
          departments =  new Department[5];
          addDepartment("Java专业","Java专业");
          addDepartment("C专业","C专业");
          addDepartment("C++专业","C++专业");
      }
  
      @Override
      public void addDepartment(String name, String desc) {
          Department department = new Department(name, desc);
          departments[numOfDepartment++] = department;
  
      }
  
      @Override
      public Iterator createIterator() {
          return new ComputerCollegeIterator(departments);
      }
  }
  =====================================
  public class ComputerCollegeIterator implements Iterator {
      // 此方式使用数组存储
  
      Department[] departments;
      int position = 0;
  
      public ComputerCollegeIterator(Department[] departments) {
          this.departments = departments;
      }
  
  
      @Override
      public void remove() {
          // 删除方法默认空实现
      }
  
      @Override
      public void forEachRemaining(Consumer action) {
          Iterator.super.forEachRemaining(action);
      }
  
      @Override
      public boolean hasNext() {
          if (position >= departments.length || departments[position] == null) {
  
              return false;
          } else {
              return true;
          }
      }
  
      @Override
      public Object next() {
          Department department = departments[position];
          position++;
          return department;
      }
  }
  ====================================
  public class Department {
      private String name;
      private String desc;
  
      public Department(String name, String desc) {
          this.name = name;
          this.desc = desc;
      }
  
      public String getName() {
          return name;
      }
  
      public void setName(String name) {
          this.name = name;
      }
  
      public String getDesc() {
          return desc;
      }
  
      public void setDesc(String desc) {
          this.desc = desc;
      }
  
  }
  =================================
  public class InfoCollege implements College {
  
      List<Department> departmentList;
  
      public InfoCollege() {
          departmentList = new ArrayList<>();
          addDepartment("信息安全","信息安全");
          addDepartment("网络安全","网络安全");
          addDepartment("人生安全","人生安全");
      }
  
      @Override
      public String getName() {
          return "信息工程学院";
      }
  
      @Override
      public void addDepartment(String name, String desc) {
          Department department = new Department(name, desc);
          departmentList.add(department);
      }
  
      @Override
      public Iterator createIterator() {
          return new InfoCollegeIterator(departmentList);
      }
  }
  ============================================
  public class InfoCollegeIterator implements Iterator {
      //信息工程学院以List方式存放系
      List<Department> departmentList;
      int index = -1;
  
      public InfoCollegeIterator(List<Department> departmentList) {
          this.departmentList = departmentList;
      }
  
      @Override
      public void remove() {
      }
  
      @Override
      public void forEachRemaining(Consumer action) {
      }
  
      @Override
      public boolean hasNext() {
          if (index >= departmentList.size() - 1) {
              return false;
          }
          index++;
          return true;
      }
  
      @Override
      public Object next() {
          return departmentList.get(index);
      }
  }
  =========================================
  public class OutPutImpl {
      //学院集合
      List<College> collegeList;
  
      public OutPutImpl(List<College> collegeList) {
  
          this.collegeList = collegeList;
      }
      //遍历所有学院,然后调用printDepartment 输出各个学院的系
      public void printCollege() {
  
          //从collegeList 取出所有学院, Java 中的 List 已经实现Iterator
          Iterator<College> iterator = collegeList.iterator();
  
          while(iterator.hasNext()) {
              //取出一个学院
              College college = iterator.next();
              System.out.println("=== "+college.getName() +"=====" );
              printDepartment(college.createIterator()); //得到对应迭代器
          }
      }
  
  
      //输出 学院输出 系
  
      public void printDepartment(Iterator iterator) {
          while(iterator.hasNext()) {
              Department d = (Department)iterator.next();
              System.out.println(d.getName());
          }
      }
  }
  ```

  ![image-20220313164415349](D:\typora_import_images\typora-user-images\image-20220313164415349.png)

  

  



### 观察者模式

+ 引入

  ![image-20220313165202156](D:\typora_import_images\typora-user-images\image-20220313165202156.png)

  ![image-20220313165336526](D:\typora_import_images\typora-user-images\image-20220313165336526.png)

  ```java
  // 普通方式实现
  public class Client {
      public static void main(String[] args) {
          //创建接入方 currentConditions
          CurrentConditions currentConditions = new CurrentConditions();
          //创建 WeatherData 并将 接入方 currentConditions 传递到 WeatherData中
          WeatherData weatherData = new WeatherData(currentConditions);
  
          //更新天气情况
          weatherData.setData(30, 150, 40);
  
          //天气情况变化
          System.out.println("============天气情况变化=============");
          weatherData.setData(40, 160, 20);
  
  
      }
  }
  ============================================
  public class CurrentConditions {
      // 温度，气压，湿度
      private float temperature;
      private float pressure;
      private float humidity;
  
      //更新 天气情况，是由 WeatherData 来调用，我使用推送模式
      public void update(float temperature, float pressure, float humidity) {
          this.temperature = temperature;
          this.pressure = pressure;
          this.humidity = humidity;
          display();
      }
  
      //显示
      public void display() {
          System.out.println("***Today mTemperature: " + temperature + "***");
          System.out.println("***Today mPressure: " + pressure + "***");
          System.out.println("***Today mHumidity: " + humidity + "***");
      }
  }
  =========================================================
  public class WeatherData {
      private float temperatrue;
      private float pressure;
      private float humidity;
      private CurrentConditions currentConditions;
      //加入新的第三方
  
      public WeatherData(CurrentConditions currentConditions) {
          this.currentConditions = currentConditions;
      }
  
      public float getTemperature() {
          return temperatrue;
      }
  
      public float getPressure() {
          return pressure;
      }
  
      public float getHumidity() {
          return humidity;
      }
  
      public void dataChange() {
          //调用 接入方的 update
          currentConditions.update(getTemperature(), getPressure(), getHumidity());
      }
  
      //当数据有更新时，就调用 setData
      public void setData(float temperature, float pressure, float humidity) {
          this.temperatrue = temperature;
          this.pressure = pressure;
          this.humidity = humidity;
          //调用dataChange， 将最新的信息 推送给 接入方 currentConditions
          dataChange();
      }
  }    
  ```

  ![image-20220313171548117](D:\typora_import_images\typora-user-images\image-20220313171548117.png)

  

  

+ 介绍

  ![image-20220313171723248](D:\typora_import_images\typora-user-images\image-20220313171723248.png)

  ![image-20220313171810138](D:\typora_import_images\typora-user-images\image-20220313171810138.png)

  ![image-20220313172255482](D:\typora_import_images\typora-user-images\image-20220313172255482.png)

  ```java
  public class Client {
      public static void main(String[] args){
          WeatherData weatherData = new WeatherData();
          CurrentConditions currentConditions = new CurrentConditions();
          Baidu baidu = new Baidu();
          // 注册观察者
          weatherData.registerObserver(currentConditions);
          weatherData.registerObserver(baidu);
          // 设置温度
          weatherData.setData(100,100,100);
          // 通知所有观察者更改数据
          weatherData.notifyObserver();
      }
  }
  ====================================
  public interface Observer {
      void update(float temperature,float pressure,float humidity);
  
  }
  ===================================
  public interface Subject {
      void registerObserver(Observer o);
      void removeObserver(Observer o);
      void notifyObserver();
  }
  ===================================
  public class Baidu implements Observer{
      // 温度，气压，湿度
      private float temperature;
      private float pressure;
      private float humidity;
  
      //更新 天气情况，是由 WeatherData 来调用，我使用推送模式
      @Override
      public void update(float temperature, float pressure, float humidity) {
          this.temperature = temperature;
          this.pressure = pressure;
          this.humidity = humidity;
          display();
      }
  
      //显示
      public void display() {
          System.out.println("***Baidu mTemperature: " + temperature + "***");
          System.out.println("***Baidu mPressure: " + pressure + "***");
          System.out.println("***Baidu mHumidity: " + humidity + "***");
      }
  }
  ===========================================
  public class CurrentConditions  implements Observer{
      // 温度，气压，湿度
      private float temperature;
      private float pressure;
      private float humidity;
  
      //更新 天气情况，是由 WeatherData 来调用，我使用推送模式
      @Override
      public void update(float temperature, float pressure, float humidity) {
          this.temperature = temperature;
          this.pressure = pressure;
          this.humidity = humidity;
          display();
      }
  
      //显示
      public void display() {
          System.out.println("***Today mTemperature: " + temperature + "***");
          System.out.println("***Today mPressure: " + pressure + "***");
          System.out.println("***Today mHumidity: " + humidity + "***");
      }
  }
  ==================================
  public class WeatherData implements Subject{
      private float temperature;
      private float pressure;
      private float humidity;
      private CurrentConditions currentConditions;
  
  
      private ArrayList<Observer> observers;
  
      // 初始化集合
      public WeatherData(){
          observers = new ArrayList<>();
      }
      //加入新的第三方
  
      public WeatherData(CurrentConditions currentConditions) {
          this.currentConditions = currentConditions;
      }
  
  
  
      public float getTemperature() {
          return temperature;
      }
  
      public float getPressure() {
          return pressure;
      }
  
      public float getHumidity() {
          return humidity;
      }
  
      public void dataChange() {
          //调用 接入方的 update
          notifyObserver();
         }
  
      //当数据有更新时，就调用 setData
      public void setData(float temperature, float pressure, float humidity) {
          this.temperature = temperature;
          this.pressure = pressure;
          this.humidity = humidity;
          //调用dataChange， 将最新的信息 推送给 接入方 currentConditions
          dataChange();
      }
  
  
      @Override
      public void registerObserver(Observer o) {
          observers.add(o); // 注册一个观察者
      }
  
      @Override
      public void removeObserver(Observer o) {
          observers.remove(o); // 移除一个观察者
      }
  
      @Override
      public void notifyObserver() {
          // 遍历所有的观察者，并通知
          for (int i = 0; i < observers.size(); i++) {
              observers.get(i).update(getTemperature(),getPressure(),getHumidity());
          }
      }
  }    
  ```
  
  
  
  
  
  

### 中介者模式

+ 引入

  ![image-20220313203548912](D:\typora_import_images\typora-user-images\image-20220313203548912.png)

  ![image-20220313203625173](D:\typora_import_images\typora-user-images\image-20220313203625173.png)

  ![image-20220313203803083](D:\typora_import_images\typora-user-images\image-20220313203803083.png)

  

  

  

  

+ 介绍

  ![image-20220313204006984](D:\typora_import_images\typora-user-images\image-20220313204006984.png)

  ![image-20220313204823823](D:\typora_import_images\typora-user-images\image-20220313204823823.png)

  ![image-20220313205806013](D:\typora_import_images\typora-user-images\image-20220313205806013.png)

  ```java
  public class Alarm extends Colleague {
  
  	//构造器
  	public Alarm(Mediator mediator, String name) {
  		super(mediator, name);
  		// TODO Auto-generated constructor stub
  		//在创建Alarm 同事对象时，将自己放入到ConcreteMediator 对象中[集合]
  		mediator.Register(name, this);
  	}
  
  	public void SendAlarm(int stateChange) {
  		SendMessage(stateChange);
  	}
  
  	@Override
  	public void SendMessage(int stateChange) {
  		// TODO Auto-generated method stub
  		//调用的中介者对象的getMessage
  		this.GetMediator().GetMessage(stateChange, this.name);
  	}
  
  }
  =========================================
  public class ClientTest {
  
  	public static void main(String[] args) {
  		//创建一个中介者对象
  		Mediator mediator = new ConcreteMediator();
  
  		//创建Alarm 并且加入到  ConcreteMediator 对象的HashMap
  		Alarm alarm = new Alarm(mediator, "alarm");
  
  		//创建了CoffeeMachine 对象，并  且加入到  ConcreteMediator 对象的HashMap
  		CoffeeMachine coffeeMachine = new CoffeeMachine(mediator,
  				"coffeeMachine");
  
  		//创建 Curtains , 并  且加入到  ConcreteMediator 对象的HashMap
  		Curtains curtains = new Curtains(mediator, "curtains");
  		TV tV = new TV(mediator, "TV");
  
  		//让闹钟发出消息
  		alarm.SendAlarm(0);
  		coffeeMachine.FinishCoffee();
  		alarm.SendAlarm(1);
  	}
  
  }
  ==================================
  public class CoffeeMachine extends Colleague {
  
  	public CoffeeMachine(Mediator mediator, String name) {
  		super(mediator, name);
  		// TODO Auto-generated constructor stub
  		mediator.Register(name, this);
  	}
  
  	@Override
  	public void SendMessage(int stateChange) {
  		// TODO Auto-generated method stub
  		this.GetMediator().GetMessage(stateChange, this.name);
  	}
  
  	public void StartCoffee() {
  		System.out.println("It's time to startcoffee!");
  	}
  
  	public void FinishCoffee() {
  
  		System.out.println("After 5 minutes!");
  		System.out.println("Coffee is ok!");
  		SendMessage(0);
  	}
  }
  ============================================
  public abstract class Colleague {
  	private Mediator mediator;
  	public String name;
  
  	public Colleague(Mediator mediator, String name) {
  
  		this.mediator = mediator;
  		this.name = name;
  
  	}
  
  	public Mediator GetMediator() {
  		return this.mediator;
  	}
  
  	public abstract void SendMessage(int stateChange);
  }
  ============================================
  public class ConcreteMediator extends Mediator {
  	//集合，放入所有的同事对象
  	private HashMap<String, Colleague> colleagueMap;
  	private HashMap<String, String> interMap;
  
  	public ConcreteMediator() {
  		colleagueMap = new HashMap<String, Colleague>();
  		interMap = new HashMap<String, String>();
  	}
  
  	@Override
  	public void Register(String colleagueName, Colleague colleague) {
  		// TODO Auto-generated method stub
  		colleagueMap.put(colleagueName, colleague);
  
  		// TODO Auto-generated method stub
  
  		if (colleague instanceof Alarm) {
  			interMap.put("Alarm", colleagueName);
  		} else if (colleague instanceof CoffeeMachine) {
  			interMap.put("CoffeeMachine", colleagueName);
  		} else if (colleague instanceof TV) {
  			interMap.put("TV", colleagueName);
  		} else if (colleague instanceof Curtains) {
  			interMap.put("Curtains", colleagueName);
  		}
  
  	}
  
  	//具体中介者的核心方法
  	//1. 根据得到消息，完成对应任务
  	//2. 中介者在这个方法，协调各个具体的同事对象，完成任务
  	@Override
  	public void GetMessage(int stateChange, String colleagueName) {
  		// TODO Auto-generated method stub
  
  		//处理闹钟发出的消息
  		if (colleagueMap.get(colleagueName) instanceof Alarm) {
  			if (stateChange == 0) {
  				((CoffeeMachine) (colleagueMap.get(interMap
  						.get("CoffeeMachine")))).StartCoffee();
  				((TV) (colleagueMap.get(interMap.get("TV")))).StartTv();
  			} else if (stateChange == 1) {
  				((TV) (colleagueMap.get(interMap.get("TV")))).StopTv();
  			}
  
  		} else if (colleagueMap.get(colleagueName) instanceof CoffeeMachine) {
  			((Curtains) (colleagueMap.get(interMap.get("Curtains"))))
  					.UpCurtains();
  
  		} else if (colleagueMap.get(colleagueName) instanceof TV) {//如果TV发现消息
  
  		} else if (colleagueMap.get(colleagueName) instanceof Curtains) {
  			//如果是以窗帘发出的消息，这里处理...
  		}
  
  	}
  
  	@Override
  	public void SendMessage() {
  		// TODO Auto-generated method stub
  
  	}
  
  }
  ==================================================
  public class Curtains extends Colleague {
  
  	public Curtains(Mediator mediator, String name) {
  		super(mediator, name);
  		// TODO Auto-generated constructor stub
  		mediator.Register(name, this);
  	}
  
  	@Override
  	public void SendMessage(int stateChange) {
  		// TODO Auto-generated method stub
  		this.GetMediator().GetMessage(stateChange, this.name);
  	}
  
  	public void UpCurtains() {
  		System.out.println("I am holding Up Curtains!");
  	}
  
  }
  ==========================================
  public abstract class Mediator {
  	//将给中介者对象，加入到集合中
  	public abstract void Register(String colleagueName, Colleague colleague);
  
  	//接收消息, 具体的同事对象发出
  	public abstract void GetMessage(int stateChange, String colleagueName);
  
  	public abstract void SendMessage();
  }
  ===========================================
  public class TV extends Colleague {
  
  	public TV(Mediator mediator, String name) {
  		super(mediator, name);
  		// TODO Auto-generated constructor stub
  		mediator.Register(name, this);
  	}
  
  	@Override
  	public void SendMessage(int stateChange) {
  		// TODO Auto-generated method stub
  		this.GetMediator().GetMessage(stateChange, this.name);
  	}
  
  	public void StartTv() {
  		// TODO Auto-generated method stub
  		System.out.println("It's time to StartTv!");
  	}
  
  	public void StopTv() {
  		// TODO Auto-generated method stub
  		System.out.println("StopTv!");
  	}
  }
  
  ```

  

  ![image-20220313210648252](D:\typora_import_images\typora-user-images\image-20220313210648252.png)

  

  

  

### 备忘录模式

+ 引入

  ![image-20220314102138156](D:\typora_import_images\typora-user-images\image-20220314102138156.png)

  ![image-20220314102145607](D:\typora_import_images\typora-user-images\image-20220314102145607.png)

  ![image-20220314102235480](D:\typora_import_images\typora-user-images\image-20220314102235480.png)

  

  

+ 介绍

  ![image-20220314102310674](D:\typora_import_images\typora-user-images\image-20220314102310674.png)

  ![image-20220314102555208](D:\typora_import_images\typora-user-images\image-20220314102555208.png)

  ```java
  public class Client {
      public static void main(String[] args){
          Originator originator = new Originator();
          CareTacker caretacker = new CareTacker();
          originator.setState("我来");
          Memento memento = originator.saveStateMemento();
          originator.getStateFromMemento(memento);
          caretacker.add(memento); // 保存第一次状态
          originator.setState("彩笔");
          Memento memento1 = originator.saveStateMemento();
          caretacker.add(memento1); // 保存第二个状态
          System.out.println(originator.getState());
          originator.getStateFromMemento(caretacker.get(0));
          System.out.println(originator.getState());
      }
  }
  =================================
  public class Memento {
      private String state;
  
      public Memento(String state) {
          this.state = state;
      }
  
      public String getState() {
          return state;
      }
      
  }
  =================================
  public class Originator {
      private String state;
  
      public Originator() {
      }
  
      public String getState() {
          return state;
      }
  
      public void setState(String state) {
          this.state = state;
      }
  
      // 返回一个Memento对象
      public Memento saveStateMemento(){
          return new Memento(state);
      }
  
      // 通过备忘录对象 恢复状态
      public void getStateFromMemento(Memento memento){
          state = memento.getState();
      }
  }
  ============================================
  public class CareTacker {
      private List<Memento> mementoList = new ArrayList<>();
  
      public void add(Memento memento){
          mementoList.add(memento);
      }
  
      public Memento get(int index){
          return mementoList.get(index);
      }
  }
      
  ```

  ![image-20220314105542132](D:\typora_import_images\typora-user-images\image-20220314105542132.png)

  

+ 实例

  ![image-20220314105841531](D:\typora_import_images\typora-user-images\image-20220314105841531.png)

  ```java
  public class Client {
      public static void main(String[] args){
          GameRole gameRole = new GameRole();
          gameRole.setVit(100);
          gameRole.setDef(100);
          System.out.println("开始战斗");
          gameRole.display();
  
          // 把状态保存
          CareTaker careTaker = new CareTaker();
          careTaker.setMemento(gameRole.createMemento());
          System.out.println("boss开启战斗");
          gameRole.setVit(30);
          gameRole.setDef(30);
          gameRole.display();
          System.out.println("结束了");
  
          System.out.println("开始恢复数据");
          gameRole.recoverGameRoleFromMemento(careTaker.getMemento());
          System.out.println("恢复后");
          gameRole.display();
      }
  }
  =====================================
  public class GameRole {
      private int vit;
      private int def;
  
      // 创建Memento,根据当前状态得到Memento
      public Memento createMemento() {
          return new Memento(vit, def);
      }
  
      public int getVit() {
          return vit;
      }
  
      public void setVit(int vit) {
          this.vit = vit;
      }
  
      public int getDef() {
          return def;
      }
  
      public void setDef(int def) {
          this.def = def;
      }
  
      public void recoverGameRoleFromMemento(Memento memento) {
          this.vit = memento.getVit();
          this.def = memento.getDef();
      }
  
      public void display() {
          System.out.println(vit + "_" + def);
      }
  }
  ===========================================
  public class Memento {
      // 攻击力
      private int vit;
      // 防御力
      private int def;
  
      public Memento(int vit, int def) {
          this.vit = vit;
          this.def = def;
      }
  
      public int getVit() {
          return vit;
      }
  
      public void setVit(int vit) {
          this.vit = vit;
      }
  
      public int getDef() {
          return def;
      }
  
      public void setDef(int def) {
          this.def = def;
      }
  }
  ===========================================
  public class CareTaker {
      // 守护者对象，保存游戏角色的状态
  
      private Memento memento; // 保存一次状态
      private ArrayList<Memento> mementos; // 保存多个状态
      private HashMap<String,ArrayList<Memento>> rolesMementos;
  
      public Memento getMemento() {
          return memento;
      }
  
      public void setMemento(Memento memento) {
          this.memento = memento;
      }
  
  }
      
  ```

  

  

  

![image-20220314165852644](D:\typora_import_images\typora-user-images\image-20220314165852644.png)



### 解释器模式

+ 引入

  ![image-20220314171559146](D:\typora_import_images\typora-user-images\image-20220314171559146.png)

  ![image-20220314171545216](D:\typora_import_images\typora-user-images\image-20220314171545216.png)

  

+ 介绍

  ![image-20220314171902611](D:\typora_import_images\typora-user-images\image-20220314171902611.png)

  ![image-20220314172231838](D:\typora_import_images\typora-user-images\image-20220314172231838.png)

  ![image-20220314172457697](D:\typora_import_images\typora-user-images\image-20220314172457697.png)

  

  

  

+ 使用

  ![image-20220314172735041](D:\typora_import_images\typora-user-images\image-20220314172735041.png)

  ```java
  public class ClientTest {
  
      public static void main(String[] args) throws IOException {
          // TODO Auto-generated method stub
          String expStr = getExpStr(); // a+b
          HashMap<String, Integer> var = getValue(expStr);// var {a=10, b=20}
          Calculator calculator = new Calculator(expStr);
          System.out.println("运算结果：" + expStr + "=" + calculator.run(var));
      }
  
      // 获得表达式
      public static String getExpStr() throws IOException {
          System.out.print("请输入表达式：");
          return (new BufferedReader(new InputStreamReader(System.in))).readLine();
      }
  
      // 获得值映射
      public static HashMap<String, Integer> getValue(String expStr) throws IOException {
          HashMap<String, Integer> map = new HashMap<>();
  
          for (char ch : expStr.toCharArray()) {
              if (ch != '+' && ch != '-') {
                  if (!map.containsKey(String.valueOf(ch))) {
                      System.out.print("请输入" + String.valueOf(ch) + "的值：");
                      String in = (new BufferedReader(new InputStreamReader(System.in))).readLine();
                      map.put(String.valueOf(ch), Integer.valueOf(in));
                  }
              }
          }
  
          return map;
      }
  }
  ======================================
  public class Calculator {
  
      // 定义表达式
      private Expression expression;
  
      // 构造函数传参，并解析
      public Calculator(String expStr) { // expStr = a+b
          // 安排运算先后顺序
          Stack<Expression> stack = new Stack<>();
          // 表达式拆分成字符数组
          char[] charArray = expStr.toCharArray();// [a, +, b]
  
          Expression left = null;
          Expression right = null;
          //遍历我们的字符数组， 即遍历  [a, +, b]
          //针对不同的情况，做处理
          for (int i = 0; i < charArray.length; i++) {
              switch (charArray[i]) {
                  case '+': //
                      left = stack.pop();// 从stack取出left => "a"
                      right = new VarExpression(String.valueOf(charArray[++i]));// 取出右表达式 "b"
                      stack.push(new AddExpression(left, right));// 然后根据得到left 和 right 构建 AddExpresson加入stack
                      break;
                  case '-': //
                      left = stack.pop();
                      right = new VarExpression(String.valueOf(charArray[++i]));
                      stack.push(new SubExpression(left, right));
                      break;
                  default:
                      //如果是一个 Var 就创建要给 VarExpression 对象，并push到 stack
                      stack.push(new VarExpression(String.valueOf(charArray[i])));
                      break;
              }
          }
          //当遍历完整个 charArray 数组后，stack 就得到最后Expression
          this.expression = stack.pop();
      }
  
      public int run(HashMap<String, Integer> var) {
          //最后将表达式a+b和 var = {a=10,b=20}
          //然后传递给expression的interpreter进行解释执行
          return this.expression.interpreter(var);
      }
  }
  ==========================================
  public abstract class Expression {
      // a + b - c
      // 解释公式和数值, key 就是公式(表达式) 参数[a,b,c], value就是就是具体值
      // HashMap {a=10, b=20}
      public abstract int interpreter(HashMap<String, Integer> var);
  }
  ===============================
  public class VarExpression extends Expression {
  
      private String key; // key=a,key=b,key=c
  
      public VarExpression(String key) {
          this.key = key;
      }
  
      // var 就是{a=10, b=20}
      // interpreter 根据 变量名称，返回对应值
      @Override
      public int interpreter(HashMap<String, Integer> var) {
          return var.get(this.key);
      }
  }
  ======================================
  public class SymbolExpression extends Expression {
  
      protected Expression left;
      protected Expression right;
  
      public SymbolExpression(Expression left, Expression right) {
          this.left = left;
          this.right = right;
      }
  
      //因为 SymbolExpression 是让其子类来实现，因此 interpreter 是一个默认实现
      @Override
      public int interpreter(HashMap<String, Integer> var) {
          // TODO Auto-generated method stub
          return 0;
      }
  }
  ==========================================
  public class AddExpression extends SymbolExpression  {
  
      public AddExpression(Expression left, Expression right) {
          super(left, right);
      }
  
      //处理相加
      //var 仍然是 {a=10,b=20}..
      //一会我们debug 源码,就ok
      public int interpreter(HashMap<String, Integer> var) {
          //super.left.interpreter(var) ： 返回 left 表达式对应的值 a = 10
          //super.right.interpreter(var): 返回right 表达式对应值 b = 20
          return super.left.interpreter(var) + super.right.interpreter(var);
      }
  }
  ==========================================
  public class SubExpression extends SymbolExpression {
  
      public SubExpression(Expression left, Expression right) {
          super(left, right);
      }
  
      //求出left 和 right 表达式相减后的结果
      public int interpreter(HashMap<String, Integer> var) {
          return super.left.interpreter(var) - super.right.interpreter(var);
      }
  }    
  ```

  

  

![image-20220314180004218](D:\typora_import_images\typora-user-images\image-20220314180004218.png)







### 状态模式

+ 引入

  ![image-20220314180900634](D:\typora_import_images\typora-user-images\image-20220314180900634.png)

  

  

+ 基本介绍

  ![image-20220314181006123](D:\typora_import_images\typora-user-images\image-20220314181006123.png)

  ![image-20220314181457084](D:\typora_import_images\typora-user-images\image-20220314181457084.png)

  ![image-20220314181702691](D:\typora_import_images\typora-user-images\image-20220314181702691.png)

  

  

+ 实现

  ![image-20220314182820924](D:\typora_import_images\typora-user-images\image-20220314182820924.png)

  ```java
  public class ClientTest {
  
      public static void main(String[] args) {
          // TODO Auto-generated method stub
          // 创建活动对象，奖品有1个奖品
          RaffleActivity activity = new RaffleActivity(1);
  
          // 我们连续抽300次奖
          for (int i = 0; i < 30; i++) {
              System.out.println("--------第" + (i + 1) + "次抽奖----------");
              // 参加抽奖，第一步点击扣除积分
              activity.debuctMoney();
  
              // 第二步抽奖
              activity.raffle();
          }
      }
  
  }
  ====================================
  public class RaffleActivity {
  
      // state 表示活动当前的状态，是变化
      State state = null;
      // 奖品数量
      int count = 0;
  
      // 四个属性，表示四种状态
      State noRafflleState = new NoRaffleState(this);
      State canRaffleState = new CanRaffleState(this);
  
      State dispenseState =   new DispenseState(this);
      State dispensOutState = new DispenseOutState(this);
  
      //构造器
      //1. 初始化当前的状态为 noRafflleState（即不能抽奖的状态）
      //2. 初始化奖品的数量
      public RaffleActivity( int count) {
          this.state = getNoRafflleState();
          this.count = count;
      }
  
      //扣分, 调用当前状态的 deductMoney
      public void debuctMoney(){
          state.deductMoney();
      }
  
      //抽奖
      public void raffle(){
          // 如果当前的状态是抽奖成功
          if(state.raffle()){
              //领取奖品
              state.dispensePrize();
          }
  
      }
  
      public State getState() {
          return state;
      }
  
      public void setState(State state) {
          this.state = state;
      }
  
      //这里请大家注意，每领取一次奖品，count--
      public int getCount() {
          int curCount = count;
          count--;
          return curCount;
      }
  
      public void setCount(int count) {
          this.count = count;
      }
  
      public State getNoRafflleState() {
          return noRafflleState;
      }
  
      public void setNoRafflleState(State noRafflleState) {
          this.noRafflleState = noRafflleState;
      }
  
      public State getCanRaffleState() {
          return canRaffleState;
      }
  
      public void setCanRaffleState(State canRaffleState) {
          this.canRaffleState = canRaffleState;
      }
  
      public State getDispenseState() {
          return dispenseState;
      }
  
      public void setDispenseState(State dispenseState) {
          this.dispenseState = dispenseState;
      }
  
      public State getDispensOutState() {
          return dispensOutState;
      }
  
      public void setDispensOutState(State dispensOutState) {
          this.dispensOutState = dispensOutState;
      }
  }    
  ====================================
  public abstract class State {
  
  
      // 扣除积分 - 50
      public abstract void deductMoney();
  
      // 是否抽中奖品
      public abstract boolean raffle();
  
      // 发放奖品
      public abstract  void dispensePrize();
  
  }
  =========================================
  public class CanRaffleState extends State {
  
      RaffleActivity activity;
  
      public CanRaffleState(RaffleActivity activity) {
          this.activity = activity;
      }
  
      //已经扣除了积分，不能再扣
      @Override
      public void deductMoney() {
          System.out.println("已经扣取过了积分");
      }
  
      //可以抽奖, 抽完奖后，根据实际情况，改成新的状态
      @Override
      public boolean raffle() {
          System.out.println("正在抽奖，请稍等！");
          Random r = new Random();
          int num = r.nextInt(10);
          // 10%中奖机会
          if(num == 0){
              // 改变活动状态为发放奖品 context
              activity.setState(activity.getDispenseState());
              return true;
          }else{
              System.out.println("很遗憾没有抽中奖品！");
              // 改变状态为不能抽奖
              activity.setState(activity.getNoRafflleState());
              return false;
          }
      }
  
      // 不能发放奖品
      @Override
      public void dispensePrize() {
          System.out.println("没中奖，不能发放奖品");
      }
  }
  ===================================
  public class DispenseOutState extends State {
  
      // 初始化时传入活动引用
      RaffleActivity activity;
  
      public DispenseOutState(RaffleActivity activity) {
          this.activity = activity;
      }
      @Override
      public void deductMoney() {
          System.out.println("奖品发送完了，请下次再参加");
      }
  
      @Override
      public boolean raffle() {
          System.out.println("奖品发送完了，请下次再参加");
          return false;
      }
  
      @Override
      public void dispensePrize() {
          System.out.println("奖品发送完了，请下次再参加");
      }
  }
  =====================================
  public class DispenseState extends State {
  
      // 初始化时传入活动引用，发放奖品后改变其状态
      RaffleActivity activity;
  
      public DispenseState(RaffleActivity activity) {
          this.activity = activity;
      }
  
      //
  
      @Override
      public void deductMoney() {
          System.out.println("不能扣除积分");
      }
  
      @Override
      public boolean raffle() {
          System.out.println("不能抽奖");
          return false;
      }
  
      //发放奖品
      @Override
      public void dispensePrize() {
          if(activity.getCount() > 0){
              System.out.println("恭喜中奖了");
              // 改变状态为不能抽奖
              activity.setState(activity.getNoRafflleState());
          }else{
              System.out.println("很遗憾，奖品发送完了");
              // 改变状态为奖品发送完毕, 后面我们就不可以抽奖
              activity.setState(activity.getDispensOutState());
              //System.out.println("抽奖活动结束");
              //System.exit(0);
          }
  
      }
  }
  ===========================================
  public class NoRaffleState extends State {
  
      // 初始化时传入活动引用，扣除积分后改变其状态
      RaffleActivity activity;
  
      public NoRaffleState(RaffleActivity activity) {
          this.activity = activity;
      }
  
      // 当前状态可以扣积分 , 扣除后，将状态设置成可以抽奖状态
      @Override
      public void deductMoney() {
          System.out.println("扣除50积分成功，您可以抽奖了");
          activity.setState(activity.getCanRaffleState());
      }
  
      // 当前状态不能抽奖
      @Override
      public boolean raffle() {
          System.out.println("扣了积分才能抽奖喔！");
          return false;
      }
  
      // 当前状态不能发奖品
      @Override
      public void dispensePrize() {
          System.out.println("不能发放奖品");
      }
  }
  =============================================
      
  ```

  ![image-20220314191422820](D:\typora_import_images\typora-user-images\image-20220314191422820.png)

  

  

### 策略模式

+ 理解

  ```java
  /*
   将一个类中方法可能出现的情况 独立成一个接口，然这个类具体去实现这些接口，然后把该接口聚合到类中，完成相同类不同方法的实现
  */
  ```

  

+ 引入

  ![image-20220314192203386](D:\typora_import_images\typora-user-images\image-20220314192203386.png)

  ![image-20220314192305994](D:\typora_import_images\typora-user-images\image-20220314192305994.png)

  ![image-20220314192544573](D:\typora_import_images\typora-user-images\image-20220314192544573.png)

  ```java
  // 传统方案
  public abstract class Duck {
      public void swim(){
          System.out.println("鸭子会游泳");
      }
      public void quack(){
          System.out.println("鸭子嘎嘎叫");
      }
      public abstract void display();
  }
  ==============================
  public class BJDuck extends Duck {
      @Override
      public void swim() {
          System.out.println("北京鸭不能飞");
      }
  
      @Override
      public void display() {
          System.out.println("我是北京鸭");
      }
  }    
  ============================
  public class ToyDuck extends Duck {
      @Override
      public void swim() {
          System.out.println("玩具鸭不会游泳");
      }
  
      @Override
      public void quack() {
          System.out.println("玩具鸭不会叫");
      }
  
      @Override
      public void display() {
          System.out.println("我是玩具鸭");
      }
  }
  ==============================
  public class WildDuck extends Duck{
      @Override
      public void display() {
          System.out.println("野生鸭");
      }
  }    
  ```

  

  ![image-20220314202617548](D:\typora_import_images\typora-user-images\image-20220314202617548.png)

  

  

+ 介绍

  ![image-20220314203219483](D:\typora_import_images\typora-user-images\image-20220314203219483.png)

  ![image-20220314203752482](D:\typora_import_images\typora-user-images\image-20220314203752482.png)

  

  

+ 实现

  ![image-20220314203911272](D:\typora_import_images\typora-user-images\image-20220314203911272.png)

  ![image-20220314204216981](D:\typora_import_images\typora-user-images\image-20220314204216981.png)

  ```java
  public class Client {
      public static void main(String[] args){
          BJDuck bjDuck = new BJDuck();
          bjDuck.display();
          bjDuck.fly();
          bjDuck.quack();
  
          ToyDuck toyDuck = new ToyDuck();
          toyDuck.display();
          toyDuck.fly();
          toyDuck.quack();
  
          WildDuck wildDuck = new WildDuck();
          wildDuck.display();
          wildDuck.fly();
          wildDuck.quack();
  
      }
  }
  ==========================================
  public abstract class Duck {
      FlyBehavior flyBehavior;
      QuackBehavior quackBehavior;
  
      public void fly() {
          if (flyBehavior != null) {
              flyBehavior.fly();
          }
      }
      public void quack() {
          if (quackBehavior != null) {
              quackBehavior.quack();
          }
      }
      public abstract void display();
  }
  ===========================================
  public class BJDuck extends Duck {
      public BJDuck() {
          flyBehavior = new NoFlyBehavior();
          quackBehavior = new BJDuckQuackBehavior();
      }
  
      @Override
      public void display() {
          System.out.println("我是北京鸭");
      }
  }
  ===========================================
  public class ToyDuck extends Duck {
      public ToyDuck() {
          flyBehavior = new NoFlyBehavior();
          quackBehavior = new ToyDuckQuackBehavior();
      }
  
      @Override
      public void display() {
          System.out.println("我是玩具鸭");
      }
  }
  ===============================================
  public class WildDuck extends Duck {
      public WildDuck() {
          flyBehavior = new GoodFlyBehavior();
          quackBehavior = new WildDuckQuackBehavior();
      }
  
      @Override
      public void display() {
          System.out.println("野生鸭");
      }
  }
  ========================================================
  public interface FlyBehavior {
      void fly();
  }
  =====================================
  public class GoodFlyBehavior implements  FlyBehavior{
      @Override
      public void fly() {
          System.out.println("我擅长飞行");
      }
  }
  ==========================================
  public class BadFlyBehavior implements FlyBehavior{
      @Override
      public void fly() {
          System.out.println("我飞行计数很烂");
      }
  }
  ====================================
  public class NoFlyBehavior implements FlyBehavior {
      @Override
      public void fly() {
          System.out.println("我不会飞翔");
      }
  }
  =================================
  public interface QuackBehavior {
      void quack();
  }
  ================================
  public class BJDuckQuackBehavior implements QuackBehavior{
      @Override
      public void quack() {
          System.out.println("北京鸭再咆哮~");
      }
  }
  ==========================================
  public class ToyDuckQuackBehavior implements QuackBehavior{
      @Override
      public void quack() {
          System.out.println("玩具鸭不会叫");
      }
  }
  =======================================
  public class WildDuckQuackBehavior implements QuackBehavior{
      @Override
      public void quack() {
          System.out.println("野生鸭叫的很凶");
      }
  }    
  ```

  ![image-20220314210659892](D:\typora_import_images\typora-user-images\image-20220314210659892.png)

  

  

  

  

### 职责链模式

+ 引入

  ![image-20220314211608164](D:\typora_import_images\typora-user-images\image-20220314211608164.png)

  ![image-20220314212033906](D:\typora_import_images\typora-user-images\image-20220314212033906.png)

  

  

  

+ 介绍

  ![image-20220314212203227](D:\typora_import_images\typora-user-images\image-20220314212203227.png)

  ![image-20220314212706586](D:\typora_import_images\typora-user-images\image-20220314212706586.png)

  ![image-20220314213023580](D:\typora_import_images\typora-user-images\image-20220314213023580.png)

  

  

  

+ 实现

  ![image-20220314213540772](D:\typora_import_images\typora-user-images\image-20220314213540772.png)

  ```java
  public class Client {
      public static void main(String[] args){
          // 此方法使用多个类对原本需要使用if-else if-else... 进行解耦，使结构清晰
  
          // 设置一个请求
          PurchaseRequest purchaseRequest = new PurchaseRequest(1,31000,1);
  
  
          // 创建相关的审批人
          DepartmentApprover dep1 = new DepartmentApprover("张主任");
          CollegeApprover col1 = new CollegeApprover("李院长");
          ViceSchoolMasterApprover vic1 = new ViceSchoolMasterApprover("张校长");
          SchoolMasterApprover sch1 = new SchoolMasterApprover("梅校长");
  
          // 使审批人构成环形，这样方便查找调用
          dep1.setApprover(col1);
          col1.setApprover(vic1);
          vic1.setApprover(sch1);
  
          // 开始执行查找
          dep1.processRequest(purchaseRequest);
  
      }
  }
  ============================================
  public class PurchaseRequest {
      private int type;
      private int price;
      private int id;
  
      public int getType() {
          return type;
      }
  
      public int getPrice() {
          return price;
      }
  
      public int getId() {
          return id;
      }
  
      public PurchaseRequest(int type, int price, int id) {
          this.type = type;
          this.price = price;
          this.id = id;
      }
  }
  ==================================================
  public abstract class Approver {
      Approver approver;
      String name;
  
      public Approver(String name) {
          this.name = name;
      }
  
      public void setApprover(Approver approver) {
          this.approver = approver;
      }
  
      public abstract void processRequest(PurchaseRequest purchaseRequest);
  }
  =====================================================
  public class DepartmentApprover extends Approver {
      public DepartmentApprover(String name) {
          super(name);
      }
  
      @Override
      public void processRequest(PurchaseRequest purchaseRequest) {
          if (purchaseRequest.getPrice() <= 5000) {
              System.out.println("请求编号 id=" + purchaseRequest.getId() + "被 " + this.name + "处理了");
          }else{
              approver.processRequest(purchaseRequest);
          }
      }
  }
  ===============================================
  public class CollegeApprover extends Approver{
      public CollegeApprover(String name) {
          super(name);
      }
  
      @Override
      public void processRequest(PurchaseRequest purchaseRequest) {
          if (purchaseRequest.getPrice() >= 5000 &&purchaseRequest.getPrice() <= 10000 ) {
              System.out.println("请求编号 id=" + purchaseRequest.getId() + "被 " + this.name + "处理了");
          }else{
              approver.processRequest(purchaseRequest);
          }
      }
  }
  ================================================
  public class SchoolMasterApprover extends Approver{
      public SchoolMasterApprover(String name) {
          super(name);
      }
  
      @Override
      public void processRequest(PurchaseRequest purchaseRequest) {
          if (purchaseRequest.getPrice() > 30000 ) {
              System.out.println("请求编号 id=" + purchaseRequest.getId() + "被 " + this.name + "处理了");
          }else{
              approver.processRequest(purchaseRequest);
          }
      }
  }
  ===================================================
  public class ViceSchoolMasterApprover extends Approver{
      public ViceSchoolMasterApprover(String name) {
          super(name);
      }
  
      @Override
      public void processRequest(PurchaseRequest purchaseRequest) {
          if (purchaseRequest.getPrice() >= 10000 &&purchaseRequest.getPrice() <= 30000 ) {
              System.out.println("请求编号 id=" + purchaseRequest.getId() + "被 " + this.name + "处理了");
          }else{
              approver.processRequest(purchaseRequest);
          }
      }
  }    
  ```
  
  ![image-20220315102218335](D:\typora_import_images\typora-user-images\image-20220315102218335.png)
  
  

